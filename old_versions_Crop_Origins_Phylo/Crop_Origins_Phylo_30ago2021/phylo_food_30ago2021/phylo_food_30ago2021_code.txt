
# 27th september 2019

#this script has two parts:

# 1.- SCRIPTS FOR OBTAINING THE PHYLO FOOD V 1.0 DATED PHYLOGENETIC TREE OF FOOD PLANTS ("phylo_food_1_0.tre")
			# this is a fully resolved and dated phylogenetic tree of the 866 crop species (with 866 tips)

# 2.- SCRIPTS FOR BINDING ALL CROP SPS TO THE GBOTB PHYLOGENTY OF 74531 SPECIES OF VASCULAR PLANTS AVAILABLE IN V.PHYLOMAKER ("phylo_GBOTB_with_crops.tre")
			# this is a non-fully resolved phylogenetic tree of the vascular plants and the 866 crop species (with 74736 tips)



#################################################
#################################################

# 1.- SCRIPTS FOR OBTAINING THE PHYLO FOOD V 1.0 DATED PHYLOGENETIC TREE OF FOOD PLANTS ("phylo_food_1_0.tre")

#################################################
#################################################



#all references in the code below available in "sources_used_to_resolve_phylo_food_1_0.ris"



setwd("C:/Users/ruben.milla/Desktop/macroevol_domest/data/database_categorical")#set your wd
#rm(list=ls()) # clean out elements

#load packages
library(ape)
library(devtools)
library(phytools)




#read backbone tree:
# largest dated angiosp phylo tree (ca. 75000 sps) to date (9-apr-2019): GBOTB.extended phylo: 
#Jin Y & Qian H (2019) V.PhyloMaker: an R package that can generate very large phylogenies for vascular plants, Ecography, DOI: 10.1111/ecog.04434
#https://github.com/jinyizju/V.PhyloMaker
#not in CRAN, so stored as the zip file of the package at "V.PhyloMaker-master" folder 

load(file = "V.PhyloMaker-master/data/GBOTB.extended.rda")
GBOTB.extended.phylo <- GBOTB.extended
#plot(GBOTB.extended.phylo,type = "fan", cex=0.1)
#str(GBOTB.extended.phylo)

#get list of crop species:
data<-read.csv("data/database_categorical_partim.csv", header=T, dec=".", sep=";", row.names="Species_name_")
#str(data)
my_taxa <- data.frame(species = data$Species_name, genus = data$genus, family = data$Family)
str(my_taxa)

#source V.PhyloMaker functions:
source("V.PhyloMaker-master/R/phylo.maker.R")
source("V.PhyloMaker-master/R/ancestor.R")
source("V.PhyloMaker-master/R/bind.relative.R")
source("V.PhyloMaker-master/R/build.nodes.1.R")
source("V.PhyloMaker-master/R/build.nodes.2.R")
source("V.PhyloMaker-master/R/cluster.R")
source("V.PhyloMaker-master/R/ext.node.R")
source("V.PhyloMaker-master/R/int.node.R")
source("V.PhyloMaker-master/R/at.node.R")

#load V.PhyloMaker nodes and tips info data for GBOTB.extended phylo:
load(file = "V.PhyloMaker-master/data/nodes.info.1.rda")
load(file = "V.PhyloMaker-master/data/nodes.info.2.rda")
load(file = "V.PhyloMaker-master/data/tips.info.rda")



### run phylo.maker to prune GBOTB.extended phylo for my list of taxa, using Scen 1 (new tips are added as genus or family based polytomies) 
result <- phylo.maker(my_taxa, scenarios="S1")
phylo_866_polyt <- result$scenario.1
str(phylo_866_polyt)
is.ultrametric(phylo_866_polyt)

is.binary(phylo_866_polyt)
#false, as should be
is.rooted(phylo_866_polyt)
min(phylo_866_polyt$edge.length)
plot(phylo_866_polyt,cex=0.1)

#write.tree(phylo_866_polyt,"data/phylo_866_polyt.txt")



### this is a baseline phylogeny, with 52 (+ 1 that remained undetected in this step, see ending lines of this code) nodes with polytomies, 

#locate which nodes have polytomies (node.id below):
nodes_polyt <- which(table(phylo_866_polyt$edge[,1])>2) #node ids (numbers) that are not bi-furcating
nodes_polyt_df <-as.data.frame(which(table(phylo_866_polyt$edge[,1])>2))
nodes_polyt_df$node.id <- as.numeric(rownames(nodes_polyt_df))
str(nodes_polyt_df)

##ok, now extract all clades with polytomies:

clades_with_polyt <- list(length(nodes_polyt_df[,2]))

for(i in 1:length(nodes_polyt_df[,2])) {

clades_with_polyt[[i]]<-extract.clade(phylo_866_polyt,nodes_polyt_df[i,2],root.edge = 0, collapse.singles = TRUE,
              interactive = FALSE)

}

#plot 1 of them
plot(clades_with_polyt[[52]])
#now look for literature suitable to solve all those 52 polytomies topologically
#and update the list of my taxa to add species.relative	and genus.relative columns to later use V.PhyloMaker::bind.relative
#i update that list externally in excel:

write.table (my_taxa, "my_taxa_for_bind.relative.txt")



#I copy a working version of the polytomic phylo:
phylo_866_polyt_working <- phylo_866_polyt


#####################

#####################


#below, down to the end of the code, each polytomy is solved separately, removing the problematic taxa (or clade) from phylo_866_polyt_working,
#and re-binding it again at the appropriate edge, according to the literature sources cited.

#####################

#####################



## ok, start with clade 1: asteraceae:

#(clades_with_polyt[[1]])
#sources to solve polytomies: Funk et al. Systematics, Evolution and Biogeography of Compositae. 2009 and specific papers for Tribes)

plot(clades_with_polyt[[1]])

#first step: i re-locate Enydra (tribe Neurolaea):

#first i remove it from the tree:
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Enydra_fluctuans")

#then find out the edge, and its length, where it has to be re-located, according to Funk et al.
node_for_Enydra_fluctuans <- getMRCA(phylo_866_polyt_working, c("Acmella_oleracea","Stevia_rebaudiana"))
edge_for_Enydra_fluctuans <- which(phylo_866_polyt_working$edge[,2]==node_for_Enydra_fluctuans)
edge_length_of_edge_for_Enydra_fluctuans <- phylo_866_polyt_working$edge.length[edge_for_Enydra_fluctuans]

 
#re-bind it to the tree:
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Enydra_fluctuans", edge.length=NULL, where=node_for_Enydra_fluctuans, position=edge_length_of_edge_for_Enydra_fluctuans/2,
   interactive=FALSE, )

#check if the clade was properly resolved:

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Iva_annua","Cynara_cardunculus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#good!


#second i locate Guizotia: heliantheae (and sister to MRCA "Acmella" "Helianthus") Plant Systematics and Evolution 289:77–89, 2010.


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Guizotia_abyssinica")

node_for_Guizotia_abyssinica <- getMRCA(phylo_866_polyt_working, c("Acmella_oleracea","Helianthus_annuus"))
edge_for_Guizotia_abyssinica <- which(phylo_866_polyt_working$edge[,2]==node_for_Guizotia_abyssinica)
edge_length_of_edge_for_Guizotia_abyssinica <- phylo_866_polyt_working$edge.length[edge_for_Guizotia_abyssinica]

 
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Guizotia_abyssinica", edge.length=NULL, where=node_for_Guizotia_abyssinica, position=edge_length_of_edge_for_Guizotia_abbysinica/2,
   interactive=FALSE, )

#check if the clade was properly resolved:

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Iva_annua","Cynara_cardunculus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#good!


#third i locate Iva: Heliantheae in subtribe Ambrosiinae, and thus sister to Xanthium. Pl. Syst. Evol.  195:1 12 (1995):


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Iva_annua")
node_for_Iva_annua <- which(phylo_866_polyt_working$tip.label=="Xanthium_strumarium")
edge_for_Iva_annua <- which(phylo_866_polyt_working$edge[,2]==node_for_Iva_annua)
edge_length_of_edge_for_Iva_annua <- phylo_866_polyt_working$edge.length[edge_for_Iva_annua]

phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Iva_annua", edge.length=NULL, where=node_for_Iva_annua,position=edge_length_of_edge_for_Iva_annua/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Iva_annua","Cynara_cardunculus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#good!

#fourth i locate Spilanthes: Tribe Heliantheae and sister to Acmella. Systematic Botany 25:pp. 539–565, 2000.


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Spilanthes_acmella")
node_for_Spilanthes_acmella <- which(phylo_866_polyt_working$tip.label=="Acmella_oleracea")
edge_for_Spilanthes_acmella <- which(phylo_866_polyt_working$edge[,2]==node_for_Spilanthes_acmella)
edge_length_of_edge_for_Spilanthes_acmella <- phylo_866_polyt_working$edge.length[edge_for_Spilanthes_acmella]

phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Spilanthes_acmella", edge.length=NULL, where=node_for_Spilanthes_acmella,position=edge_length_of_edge_for_Spilanthes_acmella/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Spilanthes_acmella","Cynara_cardunculus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#good!





## ok, move to clade 2: Solanum: ...difficult, 

plot(clades_with_polyt[[2]])

#after a full evening of work, i get it.


#tuberosum: Subgenus Solanum sensu stricto Section Petota Ser. Tuberosa III, (sect Petota sister to sect Lycopersicum, more than to muricatum): Systematic Botany (2007), 32(2): pp. 445–463
#stenotomum is sister to tuberosum (subgenus Solanum sensu stricto Section Petota ser Tuberosa III. BMC Evolutionary Biology 2008 8:145)
#phureja : is in ser Tuberosa III and is a derivative of stonotomum ssp. stenotomum. thus, i bind it as sister to stenotomum. Source: http://mansfeld.ipk-gatersleben.de
#goniocalyx (= subsps of stenotomum), thus i bind it as sister to the phureja-stenotomum clade. Source: http://mansfeld.ipk-gatersleben.de.
#chaucha: is in ser Tuberosa III and is a hybrid between tuberosum (ssp. andigenum) and stenotomum, but with a larger contribution (2/3) from tuberosum, so i bind it as closest sister to tuberosum. Source: Jackson, M.T., Hawkes, J.G. & Rowe, P.R. Euphytica (1977) 26: 775-783. 

#duplosinuatum: unresolved name, but its wild progenitor is S. dasyphyllum, which is shared with S. macrocarpon, and thus both (macrocarpon and duplosinuatum are sister)
#viride: unresolved name. But it is in phylos in Nature Plants 2: 16115, 2016 (as viridifolium, syn). According to those phylos bind it as sister to S. macrocarpon. Source: Nature Plants 2: 16115, 2016.
#Solanum_S_M_phylos <- read.tree("data/trees_salmanminkov2016/data/Solanum.tre")

#curtilobum: wp is S. acaule, which is in Solanum sensu stricto Section Petota Ser. Acaulia (sister to the Tuberosa clade tuberosum-stenotomum-etc). BMC Evolutionary Biology 2008 8:145; Molecular Phylogenetics and Evolution 29:187-202, 2003.
#quitoense: Subgenus Leptostemonum, section Lasiocarpa, sister to sessiliflorum. Am J Bot 93:157-169, 2006.


# first: S. viride:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_viride")
node_for_Solanum_viride <- which(phylo_866_polyt_working$tip.label=="Solanum_macrocarpon")
edge_for_Solanum_viride <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_viride)
edge_length_of_edge_for_Solanum_viride <- phylo_866_polyt_working$edge.length[edge_for_Solanum_viride]

phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_viride", edge.length=NULL, where=node_for_Solanum_viride,position=edge_length_of_edge_for_Solanum_viride/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Solanum_viride","Solanum_tuberosum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#good!


# second: S. quitoense:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_quitoense")
node_for_Solanum_quitoense <- which(phylo_866_polyt_working$tip.label=="Solanum_sessiliflorum")
edge_for_Solanum_quitoense <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_quitoense)
edge_length_of_edge_for_Solanum_quitoense <- phylo_866_polyt_working$edge.length[edge_for_Solanum_quitoense]

phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_quitoense", edge.length=NULL, where=node_for_Solanum_quitoense,position=edge_length_of_edge_for_Solanum_quitoense/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Solanum_quitoense","Solanum_tuberosum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#good!

# third: S. tuberosum:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_tuberosum")
node_for_Solanum_tuberosum <- which(phylo_866_polyt_working$tip.label=="Solanum_lycopersicum")
edge_for_Solanum_tuberosum <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_tuberosum)
edge_length_of_edge_for_Solanum_tuberosum <- phylo_866_polyt_working$edge.length[edge_for_Solanum_tuberosum]

phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_tuberosum", edge.length=NULL, where=node_for_Solanum_tuberosum,position=edge_length_of_edge_for_Solanum_tuberosum/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Solanum_tuberosum","Solanum_chaucha"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#good!


# fourth: S. curtilobum:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_curtilobum")
node_for_Solanum_curtilobum <- which(phylo_866_polyt_working$tip.label=="Solanum_tuberosum")
edge_for_Solanum_curtilobum <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_curtilobum)
edge_length_of_edge_for_Solanum_curtilobum <- phylo_866_polyt_working$edge.length[edge_for_Solanum_curtilobum]

phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_curtilobum", edge.length=NULL, where=node_for_Solanum_curtilobum,position=edge_length_of_edge_for_Solanum_curtilobum/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Solanum_curtilobum","Solanum_chaucha"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#good!


# fifth: S. stenotomum & chaucha & goniocalyx as polytomies to S. tuberosum:

Sol_tuberosa_sps_phylo<-drop.tip(checking_clade, checking_clade$tip.label[c(6,7,8,9,10,11,12,13,14,15,16,17,18,19)])
sps_list_to_bind <- Sol_tuberosa_sps_phylo$tip.label


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_stenotomum")
node_for_Solanum_stenotomum <- which(phylo_866_polyt_working$tip.label=="Solanum_tuberosum")
edge_for_Solanum_stenotomum <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_stenotomum)
edge_length_of_edge_for_Solanum_stenotomum <- phylo_866_polyt_working$edge.length[edge_for_Solanum_stenotomum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_stenotomum", edge.length=NULL, where=node_for_Solanum_stenotomum,position=edge_length_of_edge_for_Solanum_stenotomum/2,
   interactive=FALSE, )

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_phureja")
node_for_Solanum_phureja <- getMRCA(phylo_866_polyt_working, c("Solanum_tuberosum","Solanum_stenotomum"))
edge_for_Solanum_phureja <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_phureja)
edge_length_of_edge_for_Solanum_phureja <- phylo_866_polyt_working$edge.length[edge_for_Solanum_phureja]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_phureja", edge.length=NULL, where=node_for_Solanum_phureja,position=0,
   interactive=FALSE, )


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_goniocalyx")
node_for_Solanum_goniocalyx <- getMRCA(phylo_866_polyt_working, c("Solanum_tuberosum","Solanum_stenotomum"))
edge_for_Solanum_goniocalyx <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_goniocalyx)
edge_length_of_edge_for_Solanum_goniocalyx <- phylo_866_polyt_working$edge.length[edge_for_Solanum_goniocalyx]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_goniocalyx", edge.length=NULL, where=node_for_Solanum_goniocalyx,position=0,
   interactive=FALSE, )


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_chaucha")
node_for_Solanum_chaucha <- getMRCA(phylo_866_polyt_working, c("Solanum_tuberosum","Solanum_stenotomum"))
edge_for_Solanum_chaucha <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_chaucha)
edge_length_of_edge_for_Solanum_chaucha <- phylo_866_polyt_working$edge.length[edge_for_Solanum_chaucha]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_chaucha", edge.length=NULL, where=node_for_Solanum_chaucha,position=0,
   interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Solanum_anomalum","Solanum_muricatum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)






# sixth: bind duplosinuatum as sister to macrocarpon:




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_duplosinuatum")
node_for_Solanum_duplosinuatum <- which(phylo_866_polyt_working$tip.label=="Solanum_macrocarpon")
edge_for_Solanum_duplosinuatum <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_duplosinuatum)
edge_length_of_edge_for_Solanum_duplosinuatum <- phylo_866_polyt_working$edge.length[edge_for_Solanum_duplosinuatum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_duplosinuatum", edge.length=NULL, where=node_for_Solanum_duplosinuatum,position=edge_length_of_edge_for_Solanum_duplosinuatum/2,
   interactive=FALSE, )






node_for_checking <- getMRCA(phylo_866_polyt_working, c("Solanum_anomalum","Solanum_muricatum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)







#finally, i resolve the Ser. Tuberosa:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_chaucha")
node_for_Solanum_chaucha <- which(phylo_866_polyt_working$tip.label=="Solanum_tuberosum")
edge_for_Solanum_chaucha <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_chaucha)
edge_length_of_edge_for_Solanum_chaucha <- phylo_866_polyt_working$edge.length[edge_for_Solanum_chaucha]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_chaucha", edge.length=NULL, where=node_for_Solanum_chaucha,position=edge_length_of_edge_for_Solanum_chaucha/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Solanum_anomalum","Solanum_muricatum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)





phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_phureja")
node_for_Solanum_phureja <- which(phylo_866_polyt_working$tip.label=="Solanum_stenotomum")
edge_for_Solanum_phureja <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_phureja)
edge_length_of_edge_for_Solanum_phureja <- phylo_866_polyt_working$edge.length[edge_for_Solanum_phureja]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_phureja", edge.length=NULL, where=node_for_Solanum_phureja,position=edge_length_of_edge_for_Solanum_phureja/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Solanum_anomalum","Solanum_muricatum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Solanum_goniocalyx")
node_for_Solanum_goniocalyx <- getMRCA(phylo_866_polyt_working, c("Solanum_phureja","Solanum_stenotomum"))
edge_for_Solanum_goniocalyx <- which(phylo_866_polyt_working$edge[,2]==node_for_Solanum_goniocalyx)
edge_length_of_edge_for_Solanum_goniocalyx <- phylo_866_polyt_working$edge.length[edge_for_Solanum_goniocalyx]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Solanum_goniocalyx", edge.length=NULL, where=node_for_Solanum_goniocalyx,position=edge_length_of_edge_for_Solanum_goniocalyx/2,
   interactive=FALSE, )






node_for_checking <- getMRCA(phylo_866_polyt_working, c("Solanum_anomalum","Solanum_muricatum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


















## ok, move to clade 3:Physalis  
plot(clades_with_polyt[[3]])

#ixocarpa sister to philadelphica (Wikipedia)
#pruinosa (as syn nicandroides in Syst Bot 30:216-230, 2005.) sister to peruviana. Source: Syst Bot 30:216-230, 2005.
#alkekengi in a different section from all other sps: source: Syst Bot 30:216-230, 2005.


# first: P. ixocarpa:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Physalis_ixocarpa")
node_for_Physalis_ixocarpa <- which(phylo_866_polyt_working$tip.label=="Physalis_philadelphica")
edge_for_Physalis_ixocarpa <- which(phylo_866_polyt_working$edge[,2]==node_for_Physalis_ixocarpa)
edge_length_of_edge_for_Physalis_ixocarpa <- phylo_866_polyt_working$edge.length[edge_for_Physalis_ixocarpa]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Physalis_ixocarpa", edge.length=NULL, where=node_for_Physalis_ixocarpa,position=edge_length_of_edge_for_Physalis_ixocarpa/2,
   interactive=FALSE, )

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Physalis_alkekengi","Physalis_peruviana"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

# second: P. pruinosa:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Physalis_pruinosa")
node_for_Physalis_pruinosa <- which(phylo_866_polyt_working$tip.label=="Physalis_peruviana")
edge_for_Physalis_pruinosa <- which(phylo_866_polyt_working$edge[,2]==node_for_Physalis_pruinosa)
edge_length_of_edge_for_Physalis_pruinosa <- phylo_866_polyt_working$edge.length[edge_for_Physalis_pruinosa]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Physalis_pruinosa", edge.length=NULL, where=node_for_Physalis_pruinosa,position=edge_length_of_edge_for_Physalis_pruinosa/2,
   interactive=FALSE, )

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Physalis_alkekengi","Physalis_peruviana"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#ok, done!






# i move to clade 4, which looks easy:

#clades_with_polyt[[4]]
#sources to solve polytomies: Syst Bot 24:209-227. 1999; and Am J Bot 101: 92–103. 2014:

#sps to remove prior to bind: "Ipomoea eriocarpa"
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Ipomoea_eriocarpa")
#where to re-bind "Ipomoea eriocarpa" 
node_for_Ipomoea_eriocarpa <- getMRCA(phylo_866_polyt_working, c("Ipomoea_aquatica","Ipomoea_batatas"))
edge_for_Ipomoea_eriocarpa <- which(phylo_866_polyt_working$edge[,2]==node_for_Ipomoea_eriocarpa)
edge_length_of_edge_for_Ipomoea_eriocarpa <- phylo_866_polyt_working$edge.length[edge_for_Ipomoea_eriocarpa]

phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Ipomoea_eriocarpa", edge.length=NULL, where=node_for_Ipomoea_eriocarpa, position=edge_length_of_edge_for_Ipomoea_eriocarpa/2,
   interactive=FALSE, )

#check if the clade was properly resolved:

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Ipomoea_aquatica","Ipomoea_mammosa"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#good!



str(phylo_866_polyt_working)
is.ultrametric(phylo_866_polyt_working)
#false
is.binary(phylo_866_polyt_working)
is.rooted(phylo_866_polyt_working)
min(phylo_866_polyt_working$edge.length)
plot(phylo_866_polyt_working,cex=0.1)

#good!



## ok, move to clade 5 (4 was done first, see above):Vaccinium:
plot(clades_with_polyt[[5]])

# macrocarpon and oxycoccos are is Sect. Oxycoccus. corymbosum and ashei are in Sect. Cyanococcus. Enough info to solve the polytomy:
#source: G.-Q. Song, J.F. Hancock. Vaccinium. in C. Kole (Ed.), Wild Crop Relatives: Genomic and Breeding Resources: Temperate Fruits, Springer (2011), pp. 197-221.



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Vaccinium_macrocarpon")
node_for_Vaccinium_macrocarpon <- which(phylo_866_polyt_working$tip.label=="Vaccinium_oxycoccos")
edge_for_Vaccinium_macrocarpon <- which(phylo_866_polyt_working$edge[,2]==node_for_Vaccinium_macrocarpon)
edge_length_of_edge_for_Vaccinium_macrocarpon <- phylo_866_polyt_working$edge.length[edge_for_Vaccinium_macrocarpon]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Vaccinium_macrocarpon", edge.length=NULL, where=node_for_Vaccinium_macrocarpon,position=edge_length_of_edge_for_Vaccinium_macrocarpon/2,
   interactive=FALSE, )


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Vaccinium_ashei")
node_for_Vaccinium_ashei <- which(phylo_866_polyt_working$tip.label=="Vaccinium_corymbosum")
edge_for_Vaccinium_ashei <- which(phylo_866_polyt_working$edge[,2]==node_for_Vaccinium_ashei)
edge_length_of_edge_for_Vaccinium_ashei <- phylo_866_polyt_working$edge.length[edge_for_Vaccinium_ashei]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Vaccinium_ashei", edge.length=NULL, where=node_for_Vaccinium_ashei,position=edge_length_of_edge_for_Vaccinium_ashei/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Vaccinium_ashei","Vaccinium_macrocarpon"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#ok, done!



## ok, move to clade 6:Diospyros:
plot(clades_with_polyt[[6]])

# D. major (= ferrea, syn in source) is in a clade external to all other sps but D. nigra
# D. nigra is from C-America, and thus clusters within the clade of D.major (ferrea), according to source:
#source: Molecular Phylogenetics and Evolution 52: 602-620, 2009.
#ok, enough information to solve the polytomy:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Diospyros_nigra")
node_for_Diospyros_nigra <- which(phylo_866_polyt_working$tip.label=="Diospyros_major")
edge_for_Diospyros_nigra <- which(phylo_866_polyt_working$edge[,2]==node_for_Diospyros_nigra)
edge_length_of_edge_for_Diospyros_nigra <- phylo_866_polyt_working$edge.length[edge_for_Diospyros_nigra]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Diospyros_nigra", edge.length=NULL, where=node_for_Diospyros_nigra,position=edge_length_of_edge_for_Diospyros_nigra/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Diospyros_major","Diospyros_kaki"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#ok, done!


## ok, move to clade 7:Pouteria:
plot(clades_with_polyt[[7]])

# no phylogenetic information, and no sub-generic classification available.
#thus, I 
# the only info i locate are taxonomic keys, which I use to solve the topology of 3 of the 5 species in the genus.
#  Source: 
#    Sanchez-Monge E.1991. Flora agricola. Taxonomia de las Magnoliofitas (Angiospermas) de interés agricola, con excepción de las aprovechamiento exclusivamente ornamental o forestal. Madrid: Ministerio de Agricoltura, Pesca y Alimentación.
# in those keys caimito is sister to lucuma, and viridis is sister to the caimito-lucuma clade.
#for 2 species ("Pouteria_sapota"  "Pouteria_procera") i obtained no taxonomic information that permitted ascription.
#thus, those 2 sps remain as basal to all other species in the genus.


#ok:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Pouteria_sapota")
node_for_Pouteria_sapota <- which(phylo_866_polyt_working$tip.label=="Pouteria_procera")
edge_for_Pouteria_sapota <- which(phylo_866_polyt_working$edge[,2]==node_for_Pouteria_sapota)
edge_length_of_edge_for_Pouteria_sapota <- phylo_866_polyt_working$edge.length[edge_for_Pouteria_sapota]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Pouteria_sapota", edge.length=NULL, where=node_for_Pouteria_sapota,position=edge_length_of_edge_for_Pouteria_sapota/2,
   interactive=FALSE, )





phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Pouteria_viridis")
node_for_Pouteria_viridis <- which(phylo_866_polyt_working$tip.label=="Pouteria_caimito")
edge_for_Pouteria_viridis <- which(phylo_866_polyt_working$edge[,2]==node_for_Pouteria_viridis)
edge_length_of_edge_for_Pouteria_viridis <- phylo_866_polyt_working$edge.length[edge_for_Pouteria_viridis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Pouteria_viridis", edge.length=NULL, where=node_for_Pouteria_viridis,position=edge_length_of_edge_for_Pouteria_viridis/2,
   interactive=FALSE, )




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Pouteria_lucuma")
node_for_Pouteria_lucuma <- which(phylo_866_polyt_working$tip.label=="Pouteria_caimito")
edge_for_Pouteria_lucuma <- which(phylo_866_polyt_working$edge[,2]==node_for_Pouteria_lucuma)
edge_length_of_edge_for_Pouteria_lucuma <- phylo_866_polyt_working$edge.length[edge_for_Pouteria_lucuma]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Pouteria_lucuma", edge.length=NULL, where=node_for_Pouteria_lucuma,position=edge_length_of_edge_for_Pouteria_lucuma/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Pouteria_caimito","Pouteria_procera"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 8:Opuntia + Nopalea:
plot(clades_with_polyt[[8]])
#first i fix Nopalea assuming the 2 sps are sister, and their clade sister to all other Opuntia:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Nopalea_dejecta")
node_for_Nopalea_dejecta <- which(phylo_866_polyt_working$tip.label=="Nopalea_cochenillifera")
edge_for_Nopalea_dejecta <- which(phylo_866_polyt_working$edge[,2]==node_for_Nopalea_dejecta)
edge_length_of_edge_for_Nopalea_dejecta <- phylo_866_polyt_working$edge.length[edge_for_Nopalea_dejecta]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Nopalea_dejecta", edge.length=NULL, where=node_for_Nopalea_dejecta,position=edge_length_of_edge_for_Nopalea_dejecta/2,
   interactive=FALSE, )

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Nopalea_cochenillifera","Opuntia_elatior"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#second, get info on the 4 sps of Opuntia as polyt:
# O. undulata (accepted name, Ser. Opuntia) and fusicaulis (unresolved name) both sister to O. ficus-indica: source: Genetic Resources and Crop Evolution 65:759–773, 2018.
#Opuntia_S_M_phylos<- read.tree("/data/trees_salmanminkov2016/data/Opuntia.tre")
#plot(Opuntia_S_M_phylos[[1]])
#Opuntia_S_M_phylos[[1]]$tip.label
# O. hyptiacantha is in Ser. Streptacanthae, sister to O. ficus-indica-undulata-fusicaulis (Ser. Opuntia) more than to O. leucotricha (ser. Leucotrichae): source: Nature Plants volume 2, Article number: 16115 (2016)

#third, I bind hyptiacantha:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Opuntia_hyptiacantha")
node_for_Opuntia_hyptiacantha <- which(phylo_866_polyt_working$tip.label=="Opuntia_ficus-indica")
edge_for_Opuntia_hyptiacantha <- which(phylo_866_polyt_working$edge[,2]==node_for_Opuntia_hyptiacantha)
edge_length_of_edge_for_Opuntia_hyptiacantha <- phylo_866_polyt_working$edge.length[edge_for_Opuntia_hyptiacantha]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Opuntia_hyptiacantha", edge.length=NULL, where=node_for_Opuntia_hyptiacantha,position=edge_length_of_edge_for_Opuntia_hyptiacantha/2,
   interactive=FALSE, )

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Nopalea_cochenillifera","Opuntia_elatior"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

#fourth, I bind undulata:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Opuntia_undulata")
node_for_Opuntia_undulata <- which(phylo_866_polyt_working$tip.label=="Opuntia_ficus-indica")
edge_for_Opuntia_undulata <- which(phylo_866_polyt_working$edge[,2]==node_for_Opuntia_undulata)
edge_length_of_edge_for_Opuntia_undulata <- phylo_866_polyt_working$edge.length[edge_for_Opuntia_undulata]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Opuntia_undulata", edge.length=NULL, where=node_for_Opuntia_undulata,position=edge_length_of_edge_for_Opuntia_undulata/2,
   interactive=FALSE, )

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Nopalea_cochenillifera","Opuntia_elatior"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#fifth, I bind fusicaulis:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Opuntia_fusicaulis")
node_for_Opuntia_fusicaulis <- which(phylo_866_polyt_working$tip.label=="Opuntia_undulata")
edge_for_Opuntia_fusicaulis <- which(phylo_866_polyt_working$edge[,2]==node_for_Opuntia_fusicaulis)
edge_length_of_edge_for_Opuntia_fusicaulis <- phylo_866_polyt_working$edge.length[edge_for_Opuntia_fusicaulis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Opuntia_fusicaulis", edge.length=NULL, where=node_for_Opuntia_fusicaulis,position=edge_length_of_edge_for_Opuntia_fusicaulis/2,
   interactive=FALSE, )

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Nopalea_cochenillifera","Opuntia_elatior"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#ok, now fully dichotomous, but O. crystalenia is sister to all other Opuntia because there is no info at all on it






## ok, move to clade 9:already done, it was Opuntia within Nopalea, which was already resolved in [[8]]:
plot(clades_with_polyt[[9]])


## ok, move to clade 10:Chenopodium
plot(clades_with_polyt[[10]])
# C. pallidicaule sister to the berlandieri-quinoa clade
# C. bonus-henricus (former Blitnum bonus-henricus ) and C. foliosum (former Blitnum virgatum) are sister (former Blitnum genus)
#source:  Willdenowia, 42(1):5-24 (2012)	

# first, I bind pallidicaule:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Chenopodium_pallidicaule")
node_for_Chenopodium_pallidicaule <- getMRCA(phylo_866_polyt_working, c("Chenopodium_berlandieri","Chenopodium_quinoa"))
edge_for_Chenopodium_pallidicaule <- which(phylo_866_polyt_working$edge[,2]==node_for_Chenopodium_pallidicaule)
edge_length_of_edge_for_Chenopodium_pallidicaule <- phylo_866_polyt_working$edge.length[edge_for_Chenopodium_pallidicaule]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Chenopodium_pallidicaule", edge.length=NULL, where=node_for_Chenopodium_pallidicaule,position=edge_length_of_edge_for_Chenopodium_pallidicaule/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Chenopodium_berlandieri","Chenopodium_foliosum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)

# second, I bind bonus-henricus foliosum as sister:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Chenopodium_foliosum")
node_for_Chenopodium_foliosum <- which(phylo_866_polyt_working$tip.label=="Chenopodium_bonus-henricus")
edge_for_Chenopodium_foliosum <- which(phylo_866_polyt_working$edge[,2]==node_for_Chenopodium_foliosum)
edge_length_of_edge_for_Chenopodium_foliosum <- phylo_866_polyt_working$edge.length[edge_for_Chenopodium_foliosum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Chenopodium_foliosum", edge.length=NULL, where=node_for_Chenopodium_foliosum,position=edge_length_of_edge_for_Chenopodium_foliosum/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Chenopodium_berlandieri","Chenopodium_foliosum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



## ok, move to clade 11:Polygonaceae, genus Rumex (as fam.polytomy and as fork for all Rumex sps):
plot(clades_with_polyt[[11]])
#Rumex is sister to Rheum: source: TAXON 64: 1188–1201, 2015.
# patientia is in  Rumex subsect. Patientiae . source: http://www.ipni.org/
# scutatus and acetosa are in Rumex subsect. Acetosa. source: http://www.ipni.org/ and http://elianto.fisica.unimi.it/life/index.php?x=21278&d=100&l=1
# alpinus is in Rumex subsect. Alpini. source: http://www.efloras.org/florataxon.aspx?flora_id=1&taxon_id=250060768
# patientia is in a clade sister to the clade of scutatus-acetosa: source: Molecular Biology and Evolution 22: 1929–1939, 2005.
# subsect. Alpini has been proposed for integration into the larger subsect. Patientiae.
# Thus, alpinus is more closely related to patientia than to scutatus-acetosa. source: Perspectives in Plant Ecology, Evolution and Systematics 12 (2010) 67–79


# first, I bind acetosa:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Rumex_acetosa")
node_for_Rumex_acetosa <- getMRCA(phylo_866_polyt_working, c("Rheum_rhabarbarum","Rheum_officinale"))
edge_for_Rumex_acetosa <- which(phylo_866_polyt_working$edge[,2]==node_for_Rumex_acetosa)
edge_length_of_edge_for_Rumex_acetosa <- phylo_866_polyt_working$edge.length[edge_for_Rumex_acetosa]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Rumex_acetosa", edge.length=NULL, where=node_for_Rumex_acetosa,position=edge_length_of_edge_for_Rumex_acetosa/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Rumex_scutatus","Rheum_officinale"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


# second, I bind scutatus:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Rumex_scutatus")
node_for_Rumex_scutatus <- which(phylo_866_polyt_working$tip.label=="Rumex_acetosa")
edge_for_Rumex_scutatus <- which(phylo_866_polyt_working$edge[,2]==node_for_Rumex_scutatus)
edge_length_of_edge_for_Rumex_scutatus <- phylo_866_polyt_working$edge.length[edge_for_Rumex_scutatus]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Rumex_scutatus", edge.length=NULL, where=node_for_Rumex_scutatus,position=edge_length_of_edge_for_Rumex_scutatus/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Rumex_alpinus","Rheum_officinale"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



# third, I bind patientia:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Rumex_patientia")
node_for_Rumex_patientia <- getMRCA(phylo_866_polyt_working, c("Rumex_acetosa","Rumex_scutatus"))
edge_for_Rumex_patientia <- which(phylo_866_polyt_working$edge[,2]==node_for_Rumex_patientia)
edge_length_of_edge_for_Rumex_patientia <- phylo_866_polyt_working$edge.length[edge_for_Rumex_patientia]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Rumex_patientia", edge.length=NULL, where=node_for_Rumex_patientia,position=edge_length_of_edge_for_Rumex_patientia/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Rumex_alpinus","Rheum_officinale"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



# fourth, I bind alpinus:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Rumex_alpinus")
node_for_Rumex_alpinus <- which(phylo_866_polyt_working$tip.label=="Rumex_patientia")
edge_for_Rumex_alpinus <- which(phylo_866_polyt_working$edge[,2]==node_for_Rumex_alpinus)
edge_length_of_edge_for_Rumex_alpinus <- phylo_866_polyt_working$edge.length[edge_for_Rumex_alpinus]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Rumex_alpinus", edge.length=NULL, where=node_for_Rumex_alpinus,position=edge_length_of_edge_for_Rumex_alpinus/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Persicaria_hydropiper","Polygonum_maximowiczii"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




#ok! i save the working tree, just in case:

write.tree(phylo_866_polyt_working,"data/phylo_866_polyt_working.tre")



## ok, move to clade 12:Tamarindus vs Stizolobium (=Mucuna) vs resto Fabaceae
plot(clades_with_polyt[[12]],cex=0.9)
# Stizolobium pachylobium is a synonym of Mucuna pachilobia,
#so i just remove Stilozolobium pachylobium from my tree and database categorical


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Stizolobium_pachylobium")



## ok, move to clade 13:Vicia
plot(clades_with_polyt[[13]],cex=0.9)
#ervilia sister to the hirsuta-articulata clade. Source: Annals of Botany 96: 1085–1096, 2005.
#tetrasperma clade sister to all other Vicia (to 2 big clades, V.articulata-cracca and V.unijuga-sativa). Source: Journal of Plant Research 119: 513–523, 2006.
#graminea is in V.unijuga-sativa clade. Source: Systematic Botany 33: 356-363, 2008.
# and, within that clade, there are 2 subgenera: subgen. Vicia (V.sativa-pannonica) and subgen. Vicilla (V.unijuga). Source: https://species.wikimedia.org/wiki/
# graminea is in sub.gen Vicilla. Source: https://species.wikimedia.org/wiki/
# thus, i re-bind graminea as sister to V. unijuga.




# first, I bind graminea:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Vicia_graminea")
node_for_Vicia_graminea <- which(phylo_866_polyt_working$tip.label=="Vicia_unijuga")
edge_for_Vicia_graminea <- which(phylo_866_polyt_working$edge[,2]==node_for_Vicia_graminea)
edge_length_of_edge_for_Vicia_graminea <- phylo_866_polyt_working$edge.length[edge_for_Vicia_graminea]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Vicia_graminea", edge.length=NULL, where=node_for_Vicia_graminea,position=edge_length_of_edge_for_Vicia_graminea/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Vicia_tetrasperma","Vicia_sativa"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




# second, I bind ervilia:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Vicia_ervilia")
node_for_Vicia_ervilia <- getMRCA(phylo_866_polyt_working, c("Vicia_articulata","Vicia_hirsuta"))
edge_for_Vicia_ervilia <- which(phylo_866_polyt_working$edge[,2]==node_for_Vicia_ervilia)
edge_length_of_edge_for_Vicia_ervilia <- phylo_866_polyt_working$edge.length[edge_for_Vicia_ervilia]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Vicia_ervilia", edge.length=NULL, where=node_for_Vicia_ervilia,position=edge_length_of_edge_for_Vicia_ervilia/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Vicia_tetrasperma","Vicia_sativa"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)





# third, tetrasperma, no need to do anything, it is now sister to all other Vicia:






## ok, move to clade 14:Pachyrhizus
plot(clades_with_polyt[[14]],cex=0.9)

# erosus is sister to the clade ahipa-tuberosus. Source: Tropical Plant Biology 7:121–132, 2014.
#thus:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Pachyrhizus_tuberosus")
node_for_Pachyrhizus_tuberosus <- which(phylo_866_polyt_working$tip.label=="Pachyrhizus_ahipa")
edge_for_Pachyrhizus_tuberosus <- which(phylo_866_polyt_working$edge[,2]==node_for_Pachyrhizus_tuberosus)
edge_length_of_edge_for_Pachyrhizus_tuberosus <- phylo_866_polyt_working$edge.length[edge_for_Pachyrhizus_tuberosus]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Pachyrhizus_tuberosus", edge.length=NULL, where=node_for_Pachyrhizus_tuberosus,position=edge_length_of_edge_for_Pachyrhizus_tuberosus/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Pachyrhizus_tuberosus","Pachyrhizus_erosus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



## ok, move to clade 15:Phaseolus
plot(clades_with_polyt[[15]],cex=0.9)
#ritensis sister to lunatus. Source: Systematic Botany 31:779-791, 2006.
#thus:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Phaseolus_ritensis")
node_for_Phaseolus_ritensis <- which(phylo_866_polyt_working$tip.label=="Phaseolus_lunatus")
edge_for_Phaseolus_ritensis <- which(phylo_866_polyt_working$edge[,2]==node_for_Phaseolus_ritensis)
edge_length_of_edge_for_Phaseolus_ritensis <- phylo_866_polyt_working$edge.length[edge_for_Phaseolus_ritensis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Phaseolus_ritensis", edge.length=NULL, where=node_for_Phaseolus_ritensis,position=edge_length_of_edge_for_Phaseolus_ritensis/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Phaseolus_lunatus","Phaseolus_acutifolius"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)






## ok, move to clade 16:Vigna
plot(clades_with_polyt[[16]],cex=0.9)
#umbellata sister to angularis: source: Genetica 114:129–145, 2002.
#I check cylindrica in Salman-Minkov trees: Nature Plants 2:1-4, 2016.
# S_M_vigna <- read.tree("data/trees_salmanminkov2016/data/Vigna.tre")
# plot(S_M_vigna[[1]])
# in there it is a subsp. of unguiculata. But V.cylindrica is an accepted name (source: http://theplantlist.org/).
# thus i re-bind it as a close sister to unguiculata.
#subterranea belongs to sect. Vigna: source:https://species.wikimedia.org/wiki/
# which is sister to sect. Catiang (unguiculata-cylindrica). Source: Molecular Phylogenetics and Evolution 22:1-19, 2002.

#first i re-bind cylindrica:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Vigna_cylindrica")
node_for_Vigna_cylindrica <- which(phylo_866_polyt_working$tip.label=="Vigna_unguiculata")
edge_for_Vigna_cylindrica <- which(phylo_866_polyt_working$edge[,2]==node_for_Vigna_cylindrica)
edge_length_of_edge_for_Vigna_cylindrica <- phylo_866_polyt_working$edge.length[edge_for_Vigna_cylindrica]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Vigna_cylindrica", edge.length=NULL, where=node_for_Vigna_cylindrica,position=edge_length_of_edge_for_Vigna_cylindrica/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Vigna_radiata","Vigna_subterranea"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


#second I re-bind subterranea:




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Vigna_subterranea")
node_for_Vigna_subterranea <- getMRCA(phylo_866_polyt_working, c("Vigna_cylindrica","Vigna_unguiculata"))
edge_for_Vigna_subterranea <- which(phylo_866_polyt_working$edge[,2]==node_for_Vigna_subterranea)
edge_length_of_edge_for_Vigna_subterranea <- phylo_866_polyt_working$edge.length[edge_for_Vigna_subterranea]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Vigna_subterranea", edge.length=NULL, where=node_for_Vigna_subterranea,position=edge_length_of_edge_for_Vigna_subterranea/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Vigna_radiata","Vigna_umbellata"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




#third I rebid umbellata:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Vigna_umbellata")
node_for_Vigna_umbellata <- which(phylo_866_polyt_working$tip.label=="Vigna_angularis")
edge_for_Vigna_umbellata <- which(phylo_866_polyt_working$edge[,2]==node_for_Vigna_umbellata)
edge_length_of_edge_for_Vigna_umbellata <- phylo_866_polyt_working$edge.length[edge_for_Vigna_umbellata]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Vigna_umbellata", edge.length=NULL, where=node_for_Vigna_umbellata,position=edge_length_of_edge_for_Vigna_umbellata/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Vigna_radiata","Vigna_subterranea"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)





#ok! i save the working tree, just in case:

write.tree(phylo_866_polyt_working,"data/phylo_866_polyt_working.tre")




## ok, move to clade 17:Canavalia
plot(clades_with_polyt[[17]],cex=0.9)
#plagiosperma sister to ensiformis. Source: Molecular Phylogenetics and Evolution 98:133-146, 2016.



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Canavalia_plagiosperma")
node_for_Canavalia_plagiosperma <- which(phylo_866_polyt_working$tip.label=="Canavalia_ensiformis")
edge_for_Canavalia_plagiosperma <- which(phylo_866_polyt_working$edge[,2]==node_for_Canavalia_plagiosperma)
edge_length_of_edge_for_Canavalia_plagiosperma <- phylo_866_polyt_working$edge.length[edge_for_Canavalia_plagiosperma]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Canavalia_plagiosperma", edge.length=NULL, where=node_for_Canavalia_plagiosperma,position=edge_length_of_edge_for_Canavalia_plagiosperma/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Canavalia_ensiformis","Canavalia_gladiata"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




## ok, move to clade 18:Lupinus
plot(clades_with_polyt[[18]],cex=0.9)
#tauris is andean (Colombia) and, even if it is an accepted species, sometimes is cited as syn of mutabilis (e.g. http://mansfeld.ipk-gatersleben.de),
# thus i re-bind it as sister to mutabilis
#mutabilis-tauris and perennis are American and belog to subgen Platycarpos. Source: https://www.wikipedia.org/
# thus perennis is sister to mutabilis-tauris clsde

#albus is not properly placed in the phylogeny. It is sister to angustifolius-luteus clade. Source: Syst. Biol. 61(3):443–460, 2012
#cosentinii is sister to albus. source: Source: Syst. Biol. 61(3):443–460, 2012


#first i re-bind albus:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Lupinus_albus")
node_for_Lupinus_albus <- getMRCA(phylo_866_polyt_working, c("Lupinus_angustifolius","Lupinus_luteus"))
edge_for_Lupinus_albus <- which(phylo_866_polyt_working$edge[,2]==node_for_Lupinus_albus)
edge_length_of_edge_for_Lupinus_albus <- phylo_866_polyt_working$edge.length[edge_for_Lupinus_albus]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Lupinus_albus", edge.length=NULL, where=node_for_Lupinus_albus,position=edge_length_of_edge_for_Lupinus_albus/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Lupinus_consentinii","Lupinus_mutabilis"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


#second i re-bind perennis:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Lupinus_perennis")
node_for_Lupinus_perennis <- which(phylo_866_polyt_working$tip.label=="Lupinus_mutabilis")
edge_for_Lupinus_perennis <- which(phylo_866_polyt_working$edge[,2]==node_for_Lupinus_perennis)
edge_length_of_edge_for_Lupinus_perennis <- phylo_866_polyt_working$edge.length[edge_for_Lupinus_perennis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Lupinus_perennis", edge.length=NULL, where=node_for_Lupinus_perennis,position=edge_length_of_edge_for_Lupinus_perennis/2,
   interactive=FALSE, )


#third i re-bind tauris:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Lupinus_tauris")
node_for_Lupinus_tauris <- which(phylo_866_polyt_working$tip.label=="Lupinus_mutabilis")
edge_for_Lupinus_tauris <- which(phylo_866_polyt_working$edge[,2]==node_for_Lupinus_tauris)
edge_length_of_edge_for_Lupinus_tauris <- phylo_866_polyt_working$edge.length[edge_for_Lupinus_tauris]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Lupinus_tauris", edge.length=NULL, where=node_for_Lupinus_tauris,position=edge_length_of_edge_for_Lupinus_tauris/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Lupinus_albus","Lupinus_mutabilis"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




#fourth i re-bind cosentinii:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Lupinus_consentinii")
node_for_Lupinus_cosentinii <- which(phylo_866_polyt_working$tip.label=="Lupinus_albus")
edge_for_Lupinus_cosentinii <- which(phylo_866_polyt_working$edge[,2]==node_for_Lupinus_cosentinii)
edge_length_of_edge_for_Lupinus_cosentinii <- phylo_866_polyt_working$edge.length[edge_for_Lupinus_cosentinii]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Lupinus_cosentinii", edge.length=NULL, where=node_for_Lupinus_cosentinii,position=edge_length_of_edge_for_Lupinus_cosentinii/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Lupinus_albus","Lupinus_mutabilis"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




#ok, i check the working tree:

str(phylo_866_polyt_working)
is.ultrametric(phylo_866_polyt_working)
#false
is.binary(phylo_866_polyt_working)
is.rooted(phylo_866_polyt_working)
min(phylo_866_polyt_working$edge.length)
plot(phylo_866_polyt_working,cex=0.1)






## ok, move to clade 19:Arachis
plot(clades_with_polyt[[19]],cex=0.9)
# glabrata is sister to hypogaeae, and villosulicarpa basal to both. source: BMC Plant Biology 10:255, 2010.



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Arachis_glabrata")
node_for_Arachis_glabrata <- which(phylo_866_polyt_working$tip.label=="Arachis_hypogaea")
edge_for_Arachis_glabrata <- which(phylo_866_polyt_working$edge[,2]==node_for_Arachis_glabrata)
edge_length_of_edge_for_Arachis_glabrata <- phylo_866_polyt_working$edge.length[edge_for_Arachis_glabrata]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Arachis_glabrata", edge.length=NULL, where=node_for_Arachis_glabrata,position=edge_length_of_edge_for_Arachis_glabrata/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Arachis_hypogaea","Arachis_villosulicarpa"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


#ok! i save the working tree, just in case:

write.tree(phylo_866_polyt_working,"data/phylo_866_polyt_working.tre")



## ok, move to clade 20:Rubus
plot(clades_with_polyt[[20]],cex=0.9)
#glaucus is from subgen. Lampobatus, which is sister to Idaeobatus. Source: American Journal of Botany 86: 81–97,  1999.
#laciniatus is from subgen. Rubus, which is sister to the Idaeobatus-Lampobatus clade. Source:American Journal of Botany 86: 81–97,  1999. 
# chamaemorus is from subgen. Chamaemorus, which is basal to all other subgens. Source: American Journal of Botany 86: 81–97,  1999.
# illecebrosus, idaeus, phoenicolasius, rosifolius, occidentalis are from subgen. Idaeobatus
# 	within Idaeobatus, illecebrosus is external to all other 4 sps, according to Gleason & Cronquist NE USA Flora (weak but only source). Source: Gleason, H.A. & Cronquist, A. ( 1991) Manual of Vascular Plants of Northeastern United States and Adjacent Canada, 2nd edition. New York Botanical Garden, Bronx, New York, USA. 
# subgen. adscription from https://species.wikimedia.org/

# brasiliensis remains as basal to the genus, and illecebrosus basal to its subgen

#S_M_rubus <- read.tree("data/trees_salmanminkov2016/data/Rubus.tre")
#plot(S_M_rubus[[1]])
#those 2 taxa remaining as polytomies are not in trees_salmanminkov2016


#ok, so:

#first i re-bind glaucus:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Rubus_glaucus")
node_for_Rubus_glaucus <- getMRCA(phylo_866_polyt_working, c("Rubus_idaeus","Rubus_occidentalis"))
edge_for_Rubus_glaucus <- which(phylo_866_polyt_working$edge[,2]==node_for_Rubus_glaucus)
edge_length_of_edge_for_Rubus_glaucus <- phylo_866_polyt_working$edge.length[edge_for_Rubus_glaucus]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Rubus_glaucus", edge.length=NULL, where=node_for_Rubus_glaucus,position=edge_length_of_edge_for_Rubus_glaucus/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Rubus_brasiliensis","Rubus_chamaemorus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#second i re-bind laciniatus:




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Rubus_laciniatus")
node_for_Rubus_laciniatus <- getMRCA(phylo_866_polyt_working, c("Rubus_glaucus","Rubus_occidentalis"))
edge_for_Rubus_laciniatus <- which(phylo_866_polyt_working$edge[,2]==node_for_Rubus_laciniatus)
edge_length_of_edge_for_Rubus_laciniatus <- phylo_866_polyt_working$edge.length[edge_for_Rubus_laciniatus]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Rubus_laciniatus", edge.length=NULL, where=node_for_Rubus_laciniatus,position=edge_length_of_edge_for_Rubus_laciniatus/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Rubus_brasiliensis","Rubus_chamaemorus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#third, i re-bind illecebrosus as sister to all other in subgen Idaeobatus:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Rubus_illecebrosus")
node_for_Rubus_illecebrosus <- getMRCA(phylo_866_polyt_working, c("Rubus_idaeus","Rubus_occidentalis"))
edge_for_Rubus_illecebrosus <- which(phylo_866_polyt_working$edge[,2]==node_for_Rubus_illecebrosus)
edge_length_of_edge_for_Rubus_illecebrosus <- phylo_866_polyt_working$edge.length[edge_for_Rubus_illecebrosus]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Rubus_illecebrosus", edge.length=NULL, where=node_for_Rubus_illecebrosus,position=edge_length_of_edge_for_Rubus_illecebrosus/2,
   interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Rubus_brasiliensis","Rubus_chamaemorus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




#Rubus brasiliensis is basal to all other Rubus, but, even if not a polytomy, without any proof, so: 
checking_clade_Rubus <- checking_clade 







## ok, move to clade 21:Malus
plot(clades_with_polyt[[21]],cex=0.9)
# M. turkmenorum is a valid name, but formerly a subsp. of M.sieversii (the main wild prog of Malus domestica). source: Volk, G. Malus sieversii: A Diverse Central Asian Apple Species in the USDA-ARS National Plant Germplasm System. HortScience 48:1440-1444, 2013.
# thus, I re-bind it as sister to M. domestica



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Malus_turkmenorum")
node_for_Malus_turkmenorum <- which(phylo_866_polyt_working$tip.label=="Malus_domestica")
edge_for_Malus_turkmenorum <- which(phylo_866_polyt_working$edge[,2]==node_for_Malus_turkmenorum)
edge_length_of_edge_for_Malus_turkmenorum <- phylo_866_polyt_working$edge.length[edge_for_Malus_turkmenorum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Malus_turkmenorum", edge.length=NULL, where=node_for_Malus_turkmenorum,position=edge_length_of_edge_for_Malus_turkmenorum/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Malus_domestica","Malus_bacatta"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)







## ok, move to clade 22:Crataegus
plot(clades_with_polyt[[22]],cex=0.9)
#C. hupenensis is in Ser. Hupenense (source: https://en.wikipedia.org/wiki/Crataegus_hupehensis), 
# and both C. azarolus and orientalis are in Ser. Orientalis (source: Albarouki, E. Botanical Journal of the Linnean Society 153: 255–263, 2007.)



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Crataegus_orientalis")
node_for_Crataegus_orientalis <- which(phylo_866_polyt_working$tip.label=="Crataegus_azarolus")
edge_for_Crataegus_orientalis <- which(phylo_866_polyt_working$edge[,2]==node_for_Crataegus_orientalis)
edge_length_of_edge_for_Crataegus_orientalis <- phylo_866_polyt_working$edge.length[edge_for_Crataegus_orientalis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Crataegus_orientalis", edge.length=NULL, where=node_for_Crataegus_orientalis,position=edge_length_of_edge_for_Crataegus_orientalis/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Crataegus_azarolus","Crataegus_hupehensis"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)







## ok, move to clade 23: Pyrus
plot(clades_with_polyt[[23]],cex=0.9)
# Pyrus bretschneideri sister to pyrifolia, and both sister to communis. Source: Zheng et al. Molecular Phylogenetics and Evolution 80:54-65, 2014.


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Pyrus_bretschneideri")
node_for_Pyrus_bretschneideri <- which(phylo_866_polyt_working$tip.label=="Pyrus_pyrifolia")
edge_for_Pyrus_bretschneideri <- which(phylo_866_polyt_working$edge[,2]==node_for_Pyrus_bretschneideri)
edge_length_of_edge_for_Pyrus_bretschneideri <- phylo_866_polyt_working$edge.length[edge_for_Pyrus_bretschneideri]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Pyrus_bretschneideri", edge.length=NULL, where=node_for_Pyrus_bretschneideri,position=edge_length_of_edge_for_Pyrus_bretschneideri/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Pyrus_pyrifolia","Pyrus_communis"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



## ok, move to clade 24: Prunus
plot(clades_with_polyt[[24]],cex=0.9)
# P. simonii is sister to P. salicina. Source: Liu, W. et al. The Journal of Horticultural Science and Biotechnology 81: 242-250, 2006.
# P. chicasa is an unresolved name, and syn. to P. angustifolia in Mansfeld encyclopedia (http://mansfeld.ipk-gatersleben.de), my source for including it as a cultivated food crop.
# since P. angustifolia is in my database, I remove P. chicasa from my database and tree.

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Prunus_chicasa")

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Prunus_simonii")
node_for_Prunus_simonii <- which(phylo_866_polyt_working$tip.label=="Prunus_salicina")
edge_for_Prunus_simonii <- which(phylo_866_polyt_working$edge[,2]==node_for_Prunus_simonii)
edge_length_of_edge_for_Prunus_simonii <- phylo_866_polyt_working$edge.length[edge_for_Prunus_simonii]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Prunus_simonii", edge.length=NULL, where=node_for_Prunus_simonii,position=edge_length_of_edge_for_Prunus_simonii/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Prunus_cerasus","Prunus_salicina"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




## ok, move to clade 25: Elaeagnus
plot(clades_with_polyt[[25]],cex=0.9)
# E. umbellata is sister to E. multiflora. Source: Son, O. Korean J. Plant Res. 27(6):671-679(2014)



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Elaeagnus_umbellata")
node_for_Elaeagnus_umbellata <- which(phylo_866_polyt_working$tip.label=="Elaeagnus_multiflora")
edge_for_Elaeagnus_umbellata <- which(phylo_866_polyt_working$edge[,2]==node_for_Elaeagnus_umbellata)
edge_length_of_edge_for_Elaeagnus_umbellata <- phylo_866_polyt_working$edge.length[edge_for_Elaeagnus_umbellata]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Elaeagnus_umbellata", edge.length=NULL, where=node_for_Elaeagnus_umbellata,position=edge_length_of_edge_for_Elaeagnus_umbellata/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Elaeagnus_pungens","Elaeagnus_multiflora"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)






## ok, move to clade 26: Juglans
plot(clades_with_polyt[[26]],cex=0.9)
# have to re-bind J. honorei
# J. honorei is an accepted name, but formerly a syn. of J. neotropica in most studies (e.g. Manning, W.E. Brittonia (1960) 12: 1.; Stone, DE. et al. The J. of the Torrey Botanical Society 136:1-25, 2009).
# the most recent phylogeny places J. neotropica (=honorei) as sister to the clade nigra-hindsii. Source: Stone, DE. et al. The J. of the Torrey Botanical Society 136:1-25, 2009.



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Juglans_honorei")
node_for_Juglans_honorei <- getMRCA(phylo_866_polyt_working, c("Juglans_nigra","Juglans_hindsii"))
edge_for_Juglans_honorei <- which(phylo_866_polyt_working$edge[,2]==node_for_Juglans_honorei)
edge_length_of_edge_for_Juglans_honorei <- phylo_866_polyt_working$edge.length[edge_for_Juglans_honorei]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Juglans_honorei", edge.length=NULL, where=node_for_Juglans_honorei,position=edge_length_of_edge_for_Juglans_honorei/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Juglans_nigra","Juglans_regia"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)







## ok, move to clade 27: Garcinia
plot(clades_with_polyt[[27]],cex=0.9)
# G. mangostana is sister to the multiflora-indica clade. Source: Nature Plants 2:1-4, 2016.
# S_M_garcinia <- read.tree("data/trees_salmanminkov2016/data/Garcinia.tre")
# S_M_garcinia[[1]]$tip.label
# G. pedunculata and cochinchinensis are valid names but i cant find any phylogenetic or subgen.classification
# the only info i locate are taxonomic keys, which I use to solve the topology of the genus.
#  Source: 
#    Sanchez-Monge E.1991. Flora agricola. Taxonomia de las Magnoliofitas (Angiospermas) de interés agricola, con excepción de las aprovechamiento exclusivamente ornamental o forestal. Madrid: Ministerio de Agricoltura, Pesca y Alimentación.
# in those keys mangostana is sister to cochinchinensis, and pedunculata is sister to the mangostana-cochinchinensis clade.


#first i re-bind mangostana:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Garcinia_mangostana")
node_for_Garcinia_mangostana <- getMRCA(phylo_866_polyt_working, c("Garcinia_multiflora","Garcinia_indica"))
edge_for_Garcinia_mangostana <- which(phylo_866_polyt_working$edge[,2]==node_for_Garcinia_mangostana)
edge_length_of_edge_for_Garcinia_mangostana <- phylo_866_polyt_working$edge.length[edge_for_Garcinia_mangostana]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Garcinia_mangostana", edge.length=NULL, where=node_for_Garcinia_mangostana,position=edge_length_of_edge_for_Garcinia_mangostana/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Garcinia_pedunculata","Garcinia_indica"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#second, i rebind cochinchinensis as sister to mangostana




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Garcinia_cochinchinensis")
node_for_Garcinia_cochinchinensis <- which(phylo_866_polyt_working$tip.label=="Garcinia_mangostana")
edge_for_Garcinia_cochinchinensis <- which(phylo_866_polyt_working$edge[,2]==node_for_Garcinia_cochinchinensis)
edge_length_of_edge_for_Garcinia_cochinchinensis <- phylo_866_polyt_working$edge.length[edge_for_Garcinia_cochinchinensis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Garcinia_cochinchinensis", edge.length=NULL, where=node_for_Garcinia_cochinchinensis,position=edge_length_of_edge_for_Garcinia_cochinchinensis/2, interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Garcinia_pedunculata","Garcinia_indica"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


#third, i rebind pedunculata as sister to the cochinchinensis-mangostana clade



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Garcinia_pedunculata")
node_for_Garcinia_pedunculata <- getMRCA(phylo_866_polyt_working, c("Garcinia_cochinchinensis","Garcinia_pedunculata"))
edge_for_Garcinia_pedunculata <- which(phylo_866_polyt_working$edge[,2]==node_for_Garcinia_pedunculata)
edge_length_of_edge_for_Garcinia_pedunculata <- phylo_866_polyt_working$edge.length[edge_for_Garcinia_pedunculata]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Garcinia_pedunculata", edge.length=NULL, where=node_for_Garcinia_pedunculata,position=edge_length_of_edge_for_Garcinia_pedunculata/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Garcinia_pedunculata","Garcinia_madruno"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)














## ok, move to clade 28: Baccaurea
plot(clades_with_polyt[[28]],cex=0.9)
# motleyana sister to racemosa
#ramiflora sister to motleyana-racemosa clade
#dulcis sister to ramiflora--motleyana-racemosa clade
#source:  Haegens,  R.M.A.P.  (2000)  Taxonomy,  phylogeny,  and  bioge-ography  of  Baccaurea,  Distichirops,  and  Nothobaccaurea(Euphorbiaceae).Blumea Supplement 12.



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Baccaurea_motleyana")
node_for_Baccaurea_motleyana <- which(phylo_866_polyt_working$tip.label=="Baccaurea_racemosa")
edge_for_Baccaurea_motleyana <- which(phylo_866_polyt_working$edge[,2]==node_for_Baccaurea_motleyana)
edge_length_of_edge_for_Baccaurea_motleyana <- phylo_866_polyt_working$edge.length[edge_for_Baccaurea_motleyana]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Baccaurea_motleyana", edge.length=NULL, where=node_for_Baccaurea_motleyana,position=edge_length_of_edge_for_Baccaurea_motleyana/2,
   interactive=FALSE, )




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Baccaurea_ramiflora")
node_for_Baccaurea_ramiflora <- getMRCA(phylo_866_polyt_working, c("Baccaurea_motleyana","Baccaurea_racemosa"))
edge_for_Baccaurea_ramiflora <- which(phylo_866_polyt_working$edge[,2]==node_for_Baccaurea_ramiflora)
edge_length_of_edge_for_Baccaurea_ramiflora <- phylo_866_polyt_working$edge.length[edge_for_Baccaurea_ramiflora]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Baccaurea_ramiflora", edge.length=NULL, where=node_for_Baccaurea_ramiflora,position=edge_length_of_edge_for_Baccaurea_ramiflora/2,
   interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Baccaurea_dulcis","Baccaurea_racemosa"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 29: Cnidoscolus vs Manihot
plot(clades_with_polyt[[29]],cex=0.9)
# i re-bind the 2 sps of Cnidoscolus as sister:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Cnidoscolus_urens")
node_for_Cnidoscolus_urens <- which(phylo_866_polyt_working$tip.label=="Cnidoscolus_aconitifolius")
edge_for_Cnidoscolus_urens <- which(phylo_866_polyt_working$edge[,2]==node_for_Cnidoscolus_urens)
edge_length_of_edge_for_Cnidoscolus_urens <- phylo_866_polyt_working$edge.length[edge_for_Cnidoscolus_urens]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Cnidoscolus_urens", edge.length=NULL, where=node_for_Cnidoscolus_urens,position=edge_length_of_edge_for_Cnidoscolus_urens/2,
   interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Manihot_esculenta","Cnidoscolus_aconitifolius"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 30: Averrhoa vs Oxalis
plot(clades_with_polyt[[30]],cex=0.9)
# i re-bind the 2 sps of Oxalis as sister:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Oxalis_tuberosa")
node_for_Oxalis_tuberosa <- which(phylo_866_polyt_working$tip.label=="Oxalis_deppei")
edge_for_Oxalis_tuberosa <- which(phylo_866_polyt_working$edge[,2]==node_for_Oxalis_tuberosa)
edge_length_of_edge_for_Oxalis_tuberosa <- phylo_866_polyt_working$edge.length[edge_for_Oxalis_tuberosa]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Oxalis_tuberosa", edge.length=NULL, where=node_for_Oxalis_tuberosa,position=edge_length_of_edge_for_Oxalis_tuberosa/2,
   interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Oxalis_deppei","Averrhoa_bilimbi"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)






## ok, move to clade 31: Sinapis vs Crambe
plot(clades_with_polyt[[31]],cex=0.9)
# i re-bind the 2 sps of Crambe as sister:




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Crambe_maritima")
node_for_Crambe_maritima <- which(phylo_866_polyt_working$tip.label=="Crambe_hispanica")
edge_for_Crambe_maritima <- which(phylo_866_polyt_working$edge[,2]==node_for_Crambe_maritima)
edge_length_of_edge_for_Crambe_maritima <- phylo_866_polyt_working$edge.length[edge_for_Crambe_maritima]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Crambe_maritima", edge.length=NULL, where=node_for_Crambe_maritima,position=edge_length_of_edge_for_Crambe_maritima/2,
   interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Sinapis_alba","Crambe_hispanica"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 32: Theobroma
plot(clades_with_polyt[[32]],cex=0.9)
# microcarpum sister to bicolor
# cacao sister to microcarpum-bicolor clade
# grandiflorum sister to cacao--microcarpum-bicolor clade
#source:  Richardson, JE. Front. Ecol. Evol. 10: 120, 2015.


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Theobroma_microcarpum")
node_for_Theobroma_microcarpum <- which(phylo_866_polyt_working$tip.label=="Theobroma_bicolor")
edge_for_Theobroma_microcarpum <- which(phylo_866_polyt_working$edge[,2]==node_for_Theobroma_microcarpum)
edge_length_of_edge_for_Theobroma_microcarpum <- phylo_866_polyt_working$edge.length[edge_for_Theobroma_microcarpum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Theobroma_microcarpum", edge.length=NULL, where=node_for_Theobroma_microcarpum,position=edge_length_of_edge_for_Theobroma_microcarpum/2, interactive=FALSE, )





phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Theobroma_cacao")
node_for_Theobroma_cacao <- getMRCA(phylo_866_polyt_working, c("Theobroma_bicolor","Theobroma_microcarpum"))
edge_for_Theobroma_cacao <- which(phylo_866_polyt_working$edge[,2]==node_for_Theobroma_cacao)
edge_length_of_edge_for_Theobroma_cacao <- phylo_866_polyt_working$edge.length[edge_for_Theobroma_cacao]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Theobroma_cacao", edge.length=NULL, where=node_for_Theobroma_cacao,position=edge_length_of_edge_for_Theobroma_cacao/2,
   interactive=FALSE, )






node_for_checking <- getMRCA(phylo_866_polyt_working, c("Theobroma_grandiflorum","Theobroma_bicolor"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)











## ok, move to clade 33: Citrus
plot(clades_with_polyt[[33]],cex=0.9)

# C. mitis is a hybrid of C. reticulata and a sps of the genus Fortunella. Source: https://en.wikipedia.org/wiki/Calamondin
#  thus, I re-bind mitis as sister to C. reticulata.
# C. paradisi is a hybrid of C. sinensis and C. maxima. Source: https://en.wikipedia.org/wiki/Grapefruit.
#  with more contribution from maxima (pummelo). Source: Scora, RW. Systematic Botany 7: 170-177, 1982.
#  thus i re-bind it as sister to maxima.
# C. aurantium and C. sinensis are hybrids of C. maxima and reticulata. Source: https://en.wikipedia.org/wiki/Bitter_orange
#   C. aurantium and C. sinensis are thus varieties of the same genepool, so i bind them as sister.
#   C. sinensis genome is 2/3 C. reticulata and 1/3 C. maxima (source: Xu, Q. Nature Genetics 45:59–66, 2013). Thus I consider reticulata as the sister species of both sinensis and aurantium.


#ok, I start re-binding paradisi as sister to maxima:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Citrus_paradisi")
node_for_Citrus_paradisi <- which(phylo_866_polyt_working$tip.label=="Citrus_maxima")
edge_for_Citrus_paradisi <- which(phylo_866_polyt_working$edge[,2]==node_for_Citrus_paradisi)
edge_length_of_edge_for_Citrus_paradisi <- phylo_866_polyt_working$edge.length[edge_for_Citrus_paradisi]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Citrus_paradisi", edge.length=NULL, where=node_for_Citrus_paradisi,position=edge_length_of_edge_for_Citrus_paradisi/2, interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Citrus_maxima","Citrus_mitis"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


#ok, second i re-bind mitis as sister to reticulata:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Citrus_mitis")
node_for_Citrus_mitis <- which(phylo_866_polyt_working$tip.label=="Citrus_reticulata")
edge_for_Citrus_mitis <- which(phylo_866_polyt_working$edge[,2]==node_for_Citrus_mitis)
edge_length_of_edge_for_Citrus_mitis <- phylo_866_polyt_working$edge.length[edge_for_Citrus_mitis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Citrus_mitis", edge.length=NULL, where=node_for_Citrus_mitis,position=edge_length_of_edge_for_Citrus_mitis/2, interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Citrus_maxima","Citrus_sinensis"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


#ok, third i re-bind sinensis as sister to reticulata:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Citrus_sinensis")
node_for_Citrus_sinensis <- which(phylo_866_polyt_working$tip.label=="Citrus_reticulata")
edge_for_Citrus_sinensis <- which(phylo_866_polyt_working$edge[,2]==node_for_Citrus_sinensis)
edge_length_of_edge_for_Citrus_sinensis <- phylo_866_polyt_working$edge.length[edge_for_Citrus_sinensis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Citrus_sinensis", edge.length=NULL, where=node_for_Citrus_sinensis,position=edge_length_of_edge_for_Citrus_sinensis/2, interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Citrus_maxima","Citrus_sinensis"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




#ok, fourth i re-bind aurantium as sister to sinensis:

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Citrus_aurantium")
node_for_Citrus_aurantium <- which(phylo_866_polyt_working$tip.label=="Citrus_sinensis")
edge_for_Citrus_aurantium <- which(phylo_866_polyt_working$edge[,2]==node_for_Citrus_aurantium)
edge_length_of_edge_for_Citrus_aurantium <- phylo_866_polyt_working$edge.length[edge_for_Citrus_aurantium]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Citrus_aurantium", edge.length=NULL, where=node_for_Citrus_aurantium,position=edge_length_of_edge_for_Citrus_aurantium/2, interactive=FALSE, )

 

node_for_checking <- getMRCA(phylo_866_polyt_working, c("Citrus_medica","Citrus_japonica"))
 
checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 34: Spondias
plot(clades_with_polyt[[34]],cex=0.9)

# S. purpurea is sister to mombin. Source: Pereira, C. et al. Quimica Nova 38: 813-816, 2015.
# S. lakonensis should remain as "outgroup" to the rest of Spondias, as it was formerly from a separate genus (). Source: Mitchell, J. PhytoKeys 55: 1-92, 2015.



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Spondias_purpurea")
node_for_Spondias_purpurea <- which(phylo_866_polyt_working$tip.label=="Spondias_mombin")
edge_for_Spondias_purpurea <- which(phylo_866_polyt_working$edge[,2]==node_for_Spondias_purpurea)
edge_length_of_edge_for_Spondias_purpurea <- phylo_866_polyt_working$edge.length[edge_for_Spondias_purpurea]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Spondias_purpurea", edge.length=NULL, where=node_for_Spondias_purpurea,position=edge_length_of_edge_for_Spondias_purpurea/2, interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Spondias_lakonensis","Spondias_purpurea"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)









## ok, move to clade 35: Psidium
plot(clades_with_polyt[[35]],cex=0.9)

# P. acutangulum is in sect. Psidium, and thus is siter to P. guajava. Source: https://species.wikimedia.org/wiki/
# P. sartorianum is in sect. Calyptropsidium, and thus is sister to P. friedrichsthalianum.


 

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Psidium_acutangulum")
node_for_Psidium_acutangulum <- which(phylo_866_polyt_working$tip.label=="Psidium_guajava")
edge_for_Psidium_acutangulum <- which(phylo_866_polyt_working$edge[,2]==node_for_Psidium_acutangulum)
edge_length_of_edge_for_Psidium_acutangulum <- phylo_866_polyt_working$edge.length[edge_for_Psidium_acutangulum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Psidium_acutangulum", edge.length=NULL, where=node_for_Psidium_acutangulum,position=edge_length_of_edge_for_Psidium_acutangulum/2, interactive=FALSE, )





phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Psidium_sartorianum")
node_for_Psidium_sartorianum <- which(phylo_866_polyt_working$tip.label=="Psidium_friedrichsthalianum")
edge_for_Psidium_sartorianum <- which(phylo_866_polyt_working$edge[,2]==node_for_Psidium_sartorianum)
edge_length_of_edge_for_Psidium_sartorianum <- phylo_866_polyt_working$edge.length[edge_for_Psidium_sartorianum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Psidium_sartorianum", edge.length=NULL, where=node_for_Psidium_sartorianum,position=edge_length_of_edge_for_Psidium_sartorianum/2, interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Psidium_guineense","Psidium_sartorianum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 36: Vanilla
plot(clades_with_polyt[[36]],cex=0.9)
# V. tahitensis is a hybrid between V. planifolia and odorata. Thus, sister to planifolia in my phylogeny. Source: Cameron, KM (2011) Vanilla phylogeny and classification, pp. 243–255 in Havkin-Frenkel, D and Belanger, FC (eds), Handbook of Vanilla Science and Technology. New York: Wiley-Blackwell.





phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Vanilla_tahitensis")
node_for_Vanilla_tahitensis <- which(phylo_866_polyt_working$tip.label=="Vanilla_planifolia")
edge_for_Vanilla_tahitensis <- which(phylo_866_polyt_working$edge[,2]==node_for_Vanilla_tahitensis)
edge_length_of_edge_for_Vanilla_tahitensis <- phylo_866_polyt_working$edge.length[edge_for_Vanilla_tahitensis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Vanilla_tahitensis", edge.length=NULL, where=node_for_Vanilla_tahitensis,position=edge_length_of_edge_for_Vanilla_tahitensis/2, interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Vanilla_planifolia","Vanilla_pompona"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)







## ok, move to clade 37: Allium
plot(clades_with_polyt[[37]],cex=0.9)
# cepa (sect Cepa), schoenoprasum and ledebourianum (sect Schoenoprasum) are in subgen. Cepa
# sativum, ampeloprasum, and scorodoprasum are in subgen. Allium sect Allium
# chinense subg. Cepa, sect Sacculiferum
# fistulosum subg. Cepa, sect Cepa
# source: https://species.wikimedia.org/wiki/
# thus cepa re-bind as sister to fistulosum
# ampeloprasum is direct progenitor of sativum, thus re-bind both as sister taxa, and scorodoprasum as sister of both
# subgen Allium is sister to subgen Cepa. Source: Friesen et al. Aliso 22:372–395, 2006.
# sects Cepa and Schoenoprasum are sister within subgen Cepa. Source: Friesen et al. Aliso 22:372–395, 2006.



#first i bind all sps of subgen Allium:




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Allium_sativum")
node_for_Allium_sativum <- getMRCA(phylo_866_polyt_working, c("Allium_chinense","Allium_macrostemon"))
edge_for_Allium_sativum <- which(phylo_866_polyt_working$edge[,2]==node_for_Allium_sativum)
edge_length_of_edge_for_Allium_sativum <- phylo_866_polyt_working$edge.length[edge_for_Allium_sativum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Allium_sativum", edge.length=NULL, where=node_for_Allium_sativum,position=edge_length_of_edge_for_Allium_sativum/2,
   interactive=FALSE, )






node_for_checking <- getMRCA(phylo_866_polyt_working, c("Allium_chinense","Allium_ledebourianum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Allium_scorodoprasum")
node_for_Allium_scorodoprasum <- which(phylo_866_polyt_working$tip.label=="Allium_sativum")
edge_for_Allium_scorodoprasum <- which(phylo_866_polyt_working$edge[,2]==node_for_Allium_scorodoprasum)
edge_length_of_edge_for_Allium_scorodoprasum <- phylo_866_polyt_working$edge.length[edge_for_Allium_scorodoprasum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Allium_scorodoprasum", edge.length=NULL, where=node_for_Allium_scorodoprasum,position=edge_length_of_edge_for_Allium_scorodoprasum/2, interactive=FALSE, )







node_for_checking <- getMRCA(phylo_866_polyt_working, c("Allium_chinense","Allium_ledebourianum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)






phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Allium_ampeloprasum")
node_for_Allium_ampeloprasum <- which(phylo_866_polyt_working$tip.label=="Allium_sativum")
edge_for_Allium_ampeloprasum <- which(phylo_866_polyt_working$edge[,2]==node_for_Allium_ampeloprasum)
edge_length_of_edge_for_Allium_ampeloprasum <- phylo_866_polyt_working$edge.length[edge_for_Allium_ampeloprasum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Allium_ampeloprasum", edge.length=NULL, where=node_for_Allium_ampeloprasum,position=edge_length_of_edge_for_Allium_ampeloprasum/2, interactive=FALSE, )







node_for_checking <- getMRCA(phylo_866_polyt_working, c("Allium_chinense","Allium_ledebourianum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


#second i bind cepa:

 
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Allium_cepa")
node_for_Allium_cepa <- which(phylo_866_polyt_working$tip.label=="Allium_fistulosum")
edge_for_Allium_cepa <- which(phylo_866_polyt_working$edge[,2]==node_for_Allium_cepa)
edge_length_of_edge_for_Allium_cepa <- phylo_866_polyt_working$edge.length[edge_for_Allium_cepa]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Allium_cepa", edge.length=NULL, where=node_for_Allium_cepa,position=edge_length_of_edge_for_Allium_cepa/2, interactive=FALSE, )


#third i bind the sps in sect. Schoenoprasum as sister to sect Cepa (cepa + fistulosum):


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Allium_ledebourianum")
node_for_Allium_ledebourianum <- getMRCA(phylo_866_polyt_working, c("Allium_cepa","Allium_fistulosum"))
edge_for_Allium_ledebourianum <- which(phylo_866_polyt_working$edge[,2]==node_for_Allium_ledebourianum)
edge_length_of_edge_for_Allium_ledebourianum <- phylo_866_polyt_working$edge.length[edge_for_Allium_ledebourianum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Allium_ledebourianum", edge.length=NULL, where=node_for_Allium_ledebourianum,position=edge_length_of_edge_for_Allium_ledebourianum/2,
   interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Allium_sativum","Allium_ledebourianum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)






 
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Allium_schoenoprasum")
node_for_Allium_schoenoprasum <- which(phylo_866_polyt_working$tip.label=="Allium_ledebourianum")
edge_for_Allium_schoenoprasum <- which(phylo_866_polyt_working$edge[,2]==node_for_Allium_schoenoprasum)
edge_length_of_edge_for_Allium_schoenoprasum <- phylo_866_polyt_working$edge.length[edge_for_Allium_schoenoprasum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Allium_schoenoprasum", edge.length=NULL, where=node_for_Allium_schoenoprasum,position=edge_length_of_edge_for_Allium_schoenoprasum/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Allium_sativum","Allium_ledebourianum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)









## ok, move to clade 38: Panicum
plot(clades_with_polyt[[38]],cex=0.9)

#miliaceum sister to virgatum. Both are in Panicum s.s., and the third sps (P. antidotale) is frequently located even outside the genus and within Setaria.
#source: Aliscioni, S. et al. American Journal of Botany 90:796–821, 2003.




 
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Panicum_virgatum")
node_for_Panicum_virgatum <- which(phylo_866_polyt_working$tip.label=="Panicum_miliaceum")
edge_for_Panicum_virgatum <- which(phylo_866_polyt_working$edge[,2]==node_for_Panicum_virgatum)
edge_length_of_edge_for_Panicum_virgatum <- phylo_866_polyt_working$edge.length[edge_for_Panicum_virgatum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Panicum_virgatum", edge.length=NULL, where=node_for_Panicum_virgatum,position=edge_length_of_edge_for_Panicum_virgatum/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Panicum_miliaceum","Panicum_antidotale"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 39: Digitaria
plot(clades_with_polyt[[39]],cex=0.9)
#VOY POR AQUI!!
#exilis is sister to iburua. Source: Adoukonou-Sagbadja, H. et al. Tropical Plant Biology 3:240–251, 2010.



 
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Digitaria_exilis")
node_for_Digitaria_exilis <- which(phylo_866_polyt_working$tip.label=="Digitaria_iburua")
edge_for_Digitaria_exilis <- which(phylo_866_polyt_working$edge[,2]==node_for_Digitaria_exilis)
edge_length_of_edge_for_Digitaria_exilis <- phylo_866_polyt_working$edge.length[edge_for_Digitaria_exilis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Digitaria_exilis", edge.length=NULL, where=node_for_Digitaria_exilis,position=edge_length_of_edge_for_Digitaria_exilis/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Digitaria_sanguinalis","Digitaria_iburua"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 40: Sorghum
plot(clades_with_polyt[[40]],cex=0.9)
# S. almum is a hybrid of S. bicolor and S. halepense. Source: https://www.feedipedia.org/node/378
#whereas S. drummondii is a subsp of S. bicolor which is sometimes granted sps status and sometimes subsp status. Source: Defelice, M. Weed Technology 20:1076-1083, 2006.
#thus drummondii is more close to bicolor than almum



 
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Sorghum_drummondii")
node_for_Sorghum_drummondii <- which(phylo_866_polyt_working$tip.label=="Sorghum_bicolor")
edge_for_Sorghum_drummondii <- which(phylo_866_polyt_working$edge[,2]==node_for_Sorghum_drummondii)
edge_length_of_edge_for_Sorghum_drummondii <- phylo_866_polyt_working$edge.length[edge_for_Sorghum_drummondii]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Sorghum_drummondii", edge.length=NULL, where=node_for_Sorghum_drummondii,position=edge_length_of_edge_for_Sorghum_drummondii/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Sorghum_almum","Sorghum_bicolor"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)









## ok, move to clade 41: Zea vs Tripsacum
plot(clades_with_polyt[[41]],cex=0.9)
# I simply rebind the 2 sps of Zea as sister:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Zea_mays")
node_for_Zea_mays <- which(phylo_866_polyt_working$tip.label=="Zea_mexicana")
edge_for_Zea_mays <- which(phylo_866_polyt_working$edge[,2]==node_for_Zea_mays)
edge_length_of_edge_for_Zea_mays <- phylo_866_polyt_working$edge.length[edge_for_Zea_mays]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Zea_mays", edge.length=NULL, where=node_for_Zea_mays,position=edge_length_of_edge_for_Zea_mays/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Tripsacum_dactyloides","Zea_mexicana"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 42: Paspalum
plot(clades_with_polyt[[42]],cex=0.9)

#plicatulum is in group Plicatula, same as scrobiculatum, and is thus sister to the latter. Source: Rua, GH. et al. Plant Systematics and Evolution 288: 227–243, 2010.
#distichum is sister to all other Paspalum in my phylo. Source: Scataglini, MA. Plant Systematics and Evolution 300:1051–1070, 2014.



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Paspalum_plicatulum")
node_for_Paspalum_plicatulum <- which(phylo_866_polyt_working$tip.label=="Paspalum_scrobiculatum")
edge_for_Paspalum_plicatulum <- which(phylo_866_polyt_working$edge[,2]==node_for_Paspalum_plicatulum)
edge_length_of_edge_for_Paspalum_plicatulum <- phylo_866_polyt_working$edge.length[edge_for_Paspalum_plicatulum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Paspalum_plicatulum", edge.length=NULL, where=node_for_Paspalum_plicatulum,position=edge_length_of_edge_for_Paspalum_plicatulum/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Paspalum_distichum","Paspalum_scrobiculatum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)






## ok, move to clade 43: Poa
plot(clades_with_polyt[[43]],cex=0.9)
# nemoralis is sister to compressa. Source: Gillespie, LJ. et al. Systematic Botany 30:84–105, 2005



 
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Poa_nemoralis")
node_for_Poa_nemoralis <- which(phylo_866_polyt_working$tip.label=="Poa_compressa")
edge_for_Poa_nemoralis <- which(phylo_866_polyt_working$edge[,2]==node_for_Poa_nemoralis)
edge_length_of_edge_for_Poa_nemoralis <- phylo_866_polyt_working$edge.length[edge_for_Poa_nemoralis]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Poa_nemoralis", edge.length=NULL, where=node_for_Poa_nemoralis,position=edge_length_of_edge_for_Poa_nemoralis/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Poa_pratensis","Poa_compressa"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)











## ok, move to clade 44: Triticum
plot(clades_with_polyt[[44]],cex=0.9)
#monococcum-boeoticum clade is sister to all other Triticum in my phylo.
# source: Petersen, G. et al. Molecular Phylogenetics and Evolution Volume 39, Issue 1, April 2006, Pages 70-82
# source: Golovnina, KA. et al. Pl. Syst. Evol. 264: 195–216 (2007)
#sphaerococcum is sister to aestivum.
#dicoccon is sister to durum-carthlicum.
#spelta is sister to sphaerococcum-aestivum.
# source: Matsuoka, Y. Plant and Cell Physiology, Volume 52, Issue 5, May 2011, Pages 750–764
# timopheevii is in Sect Timopheevii, separate to the sects. of all other Triticum in my phylo
# source: Goncharov, NP. Plant Systematics and Evolution August 2011, Volume 295, Issue 1–4, pp 1–11
#and is sister to the aestivum and the dicoccon clades.
# source: Golovnina, KA. et al. Pl. Syst. Evol. 264: 195–216 (2007) 

#ok, i first rebin sphaerococcum



 
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Triticum_sphaerococcum")
node_for_Triticum_sphaerococcum <- which(phylo_866_polyt_working$tip.label=="Triticum_aestivum")
edge_for_Triticum_sphaerococcum <- which(phylo_866_polyt_working$edge[,2]==node_for_Triticum_sphaerococcum)
edge_length_of_edge_for_Triticum_sphaerococcum <- phylo_866_polyt_working$edge.length[edge_for_Triticum_sphaerococcum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Triticum_sphaerococcum", edge.length=NULL, where=node_for_Triticum_sphaerococcum,position=edge_length_of_edge_for_Triticum_sphaerococcum/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Triticum_monococcum","Triticum_aestivum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#ok, i second rebind boeoticum



 
phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Triticum_boeoticum")
node_for_Triticum_boeoticum <- which(phylo_866_polyt_working$tip.label=="Triticum_monococcum")
edge_for_Triticum_boeoticum <- which(phylo_866_polyt_working$edge[,2]==node_for_Triticum_boeoticum)
edge_length_of_edge_for_Triticum_boeoticum <- phylo_866_polyt_working$edge.length[edge_for_Triticum_boeoticum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Triticum_boeoticum", edge.length=NULL, where=node_for_Triticum_boeoticum,position=edge_length_of_edge_for_Triticum_boeoticum/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Triticum_monococcum","Triticum_aestivum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




#ok, i third rebind carthlicum




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Triticum_carthlicum")
node_for_Triticum_carthlicum <- which(phylo_866_polyt_working$tip.label=="Triticum_durum")
edge_for_Triticum_carthlicum <- which(phylo_866_polyt_working$edge[,2]==node_for_Triticum_carthlicum)
edge_length_of_edge_for_Triticum_carthlicum <- phylo_866_polyt_working$edge.length[edge_for_Triticum_carthlicum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Triticum_carthlicum", edge.length=NULL, where=node_for_Triticum_carthlicum,position=edge_length_of_edge_for_Triticum_carthlicum/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Triticum_monococcum","Triticum_aestivum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


#ok, fourth rebind spelta:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Triticum_spelta")
node_for_Triticum_spelta <- getMRCA(phylo_866_polyt_working, c("Triticum_aestivum","Triticum_sphaerococcum"))
edge_for_Triticum_spelta <- which(phylo_866_polyt_working$edge[,2]==node_for_Triticum_spelta)
edge_length_of_edge_for_Triticum_spelta <- phylo_866_polyt_working$edge.length[edge_for_Triticum_spelta]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Triticum_spelta", edge.length=NULL, where=node_for_Triticum_spelta,position=edge_length_of_edge_for_Triticum_spelta/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Triticum_monococcum","Triticum_aestivum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#ok, fifth rebind timopheevii:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Triticum_timopheevii")
node_for_Triticum_timopheevii <- getMRCA(phylo_866_polyt_working, c("Triticum_spelta","Triticum_durum"))
edge_for_Triticum_timopheevii <- which(phylo_866_polyt_working$edge[,2]==node_for_Triticum_timopheevii)
edge_length_of_edge_for_Triticum_timopheevii <- phylo_866_polyt_working$edge.length[edge_for_Triticum_timopheevii]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Triticum_timopheevii", edge.length=NULL, where=node_for_Triticum_timopheevii,position=edge_length_of_edge_for_Triticum_timopheevii/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Triticum_monococcum","Triticum_aestivum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)











## ok, move to clade 45: Bromus
plot(clades_with_polyt[[45]],cex=0.9)
#secalinus is in sect Bromus and clusters separately from all other (sect. Ceratochloa) in phylos
#mango and catharticus are hexaploid and thus from the same group within sect. Ceratochloa
#marginatus is octoploid and thus from a different group in sect. Ceratochloa
#sources:
# Saarela, J. M., Peterson, P. M., Keane, R. M., Cayouette, J., & Graham, S. W. (2007). Molecular phylogenetics of the genus Bromus (Poaceae: Pooideae) based on nuclear and chloroplast DNA sequence data. Aliso, 23, 450–467.
# Williams WM, Stewart AV, Williamson ML. (2011) Bromus Wild crop relatives: genomic and breeding resources, millets and grasses. In: Kole C (Ed.) Springer-Verlag Berlin Heidelberg, 15–30. 





phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Bromus_mango")
node_for_Bromus_mango <- which(phylo_866_polyt_working$tip.label=="Bromus_catharticus")
edge_for_Bromus_mango <- which(phylo_866_polyt_working$edge[,2]==node_for_Bromus_mango)
edge_length_of_edge_for_Bromus_mango <- phylo_866_polyt_working$edge.length[edge_for_Bromus_mango]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Bromus_mango", edge.length=NULL, where=node_for_Bromus_mango,position=edge_length_of_edge_for_Bromus_mango/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Bromus_secalinus","Bromus_catharticus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


plot(checking_clade)







phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Bromus_marginatus")
node_for_Bromus_marginatus <- getMRCA(phylo_866_polyt_working, c("Bromus_mango","Bromus_catharticus"))
edge_for_Bromus_marginatus <- which(phylo_866_polyt_working$edge[,2]==node_for_Bromus_marginatus)
edge_length_of_edge_for_Bromus_marginatus <- phylo_866_polyt_working$edge.length[edge_for_Bromus_marginatus]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Bromus_marginatus", edge.length=NULL, where=node_for_Bromus_marginatus,position=edge_length_of_edge_for_Bromus_marginatus/2,
   interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Bromus_secalinus","Bromus_catharticus"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 46: Bambusa
plot(clades_with_polyt[[46]],cex=0.9)
#vulgaris is sister to Dendrocalamopsis, which is the former genus of B. odashimae
# source: Yang, JB. et al. Taxon, Vol. 59, No. 4 (August 2010), pp. 1102-1110
# source: http://theplantlist.org/tpl1.1/
# B. horsfieldii is in former Fimbribambusa, sister to all other Bambusa in my phylo (all from subtribe Bambusinae in Bambuseae Tribe)
# source: https://en.wikipedia.org/wiki/Bambuseae




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Bambusa_odashimae")
node_for_Bambusa_odashimae <- which(phylo_866_polyt_working$tip.label=="Bambusa_vulgaris")
edge_for_Bambusa_odashimae <- which(phylo_866_polyt_working$edge[,2]==node_for_Bambusa_odashimae)
edge_length_of_edge_for_Bambusa_odashimae <- phylo_866_polyt_working$edge.length[edge_for_Bambusa_odashimae]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Bambusa_odashimae", edge.length=NULL, where=node_for_Bambusa_odashimae,position=edge_length_of_edge_for_Bambusa_odashimae/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Bambusa_horsfieldii","Bambusa_vulgaris"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)








## ok, move to clade 48: Ensete vs Musa
plot(clades_with_polyt[[48]],cex=0.9)
#i just rebind the two sps of Musa as sister:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Musa_acuminata")
node_for_Musa_acuminata <- which(phylo_866_polyt_working$tip.label=="Musa_balbisiana")
edge_for_Musa_acuminata <- which(phylo_866_polyt_working$edge[,2]==node_for_Musa_acuminata)
edge_length_of_edge_for_Musa_acuminata <- phylo_866_polyt_working$edge.length[edge_for_Musa_acuminata]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Musa_acuminata", edge.length=NULL, where=node_for_Musa_acuminata,position=edge_length_of_edge_for_Musa_acuminata/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Ensete_ventricosum","Musa_balbisiana"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)









## ok, move to clade 49: Dioscorea
plot(clades_with_polyt[[49]],cex=0.9)

#quartiniana sister to dumetorum or pentaphylla. Source: Magwé-Tindo et al. TAXON 67:905–915, 2018.
#quartiniana & pentaphylla in Sect. Botryosicyos. Dumetorum in Sect. Lasiophyton. Source: Schols, P. et al. Botanical Journal of the Linnean Society, Volume 136, Issue 3, July 2001, Pages 295–311.
#thus, quartiniana is sister to pentaphylla
# flabellifolia is in sect. Stenophora. Source: R.S. Pagare & W. Arisdason (2016) Lectotypification in the genus Dioscorea L. (Dioscoreaceae), Webbia, 71:1, 73-81
# Stenophora is the oldest sect (according to fossil record) in Dioscorea. Source: Kawabe, A. Genes Genet. Syst. (1997) 72, p. 253–262
#thus, I keep flabellifolia as sister to all other Dioscorea.




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Dioscorea_quartiniana")
node_for_Dioscorea_quartiniana <- which(phylo_866_polyt_working$tip.label=="Dioscorea_pentaphylla")
edge_for_Dioscorea_quartiniana <- which(phylo_866_polyt_working$edge[,2]==node_for_Dioscorea_quartiniana)
edge_length_of_edge_for_Dioscorea_quartiniana <- phylo_866_polyt_working$edge.length[edge_for_Dioscorea_quartiniana]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Dioscorea_quartiniana", edge.length=NULL, where=node_for_Dioscorea_quartiniana,position=edge_length_of_edge_for_Dioscorea_quartiniana/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Dioscorea_flabellifolia","Dioscorea_pentaphylla"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)










## ok, move to clade 50: Xanthosoma
plot(clades_with_polyt[[50]],cex=0.9)
# X. robustum is not a food plant. Although corms are eaten occasionally after cooking (Mansfeld Encyclopedia), 
#  it is clearly an ornamental plant. 
#  Sources: 
#      Pichon WM. Ethnobotanical Studies on Selected Plants of Northeastern Mexico. Thesis. Eastern Illinois Univ., 1972.
#      Croat TB. et al. FLORA DEL BAJÍO Y DE REGIONES ADYACENTES. Fasciculo 114. Araceae. 2003.
# thus I remove X. robustum from tree and database
# X. undipes is a former syn of sagittifolium, thus i rebind both as sister. Source: http://theplantlist.org/tpl1.1/
# no way to locate any phylogeny or subgeneric classification of the genus
# the only info i locate are taxonomic keys, which I use to solve the topology of the genus, but X. caracu.
#  Source: 
#    Sanchez-Monge E.1991. Flora agricola. Taxonomia de las Magnoliofitas (Angiospermas) de interés agricola, con excepción de las aprovechamiento exclusivamente ornamental o forestal. Madrid: Ministerio de Agricoltura, Pesca y Alimentación.
# i get no tax/phylo information of any kind of X. caracu, thus i keep it as basal and sister to all other sps in the genus.

#first: remove X.robustum (also from database)

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Xanthosoma_robustum")

#second, rebind poeppigii as sister to sagittifolium


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Xanthosoma_poeppigii")
node_for_Xanthosoma_poeppigii <- which(phylo_866_polyt_working$tip.label=="Xanthosoma_sagittifolium")
edge_for_Xanthosoma_poeppigii <- which(phylo_866_polyt_working$edge[,2]==node_for_Xanthosoma_poeppigii)
edge_length_of_edge_for_Xanthosoma_poeppigii <- phylo_866_polyt_working$edge.length[edge_for_Xanthosoma_poeppigii]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Xanthosoma_poeppigii", edge.length=NULL, where=node_for_Xanthosoma_poeppigii,position=edge_length_of_edge_for_Xanthosoma_poeppigii/2, interactive=FALSE, )




node_for_checking <- getMRCA(phylo_866_polyt_working, c("Xanthosoma_caracu","Xanthosoma_sagittifolium"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#third, rebind undipes as sister to sagittifolium


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Xanthosoma_undipes")
node_for_Xanthosoma_undipes <- which(phylo_866_polyt_working$tip.label=="Xanthosoma_sagittifolium")
edge_for_Xanthosoma_undipes <- which(phylo_866_polyt_working$edge[,2]==node_for_Xanthosoma_undipes)
edge_length_of_edge_for_Xanthosoma_undipes <- phylo_866_polyt_working$edge.length[edge_for_Xanthosoma_undipes]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Xanthosoma_undipes", edge.length=NULL, where=node_for_Xanthosoma_undipes,position=edge_length_of_edge_for_Xanthosoma_undipes/2, interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Xanthosoma_caracu","Xanthosoma_sagittifolium"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)




#fourth, rebind brasiliense as sister to belophyllum


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Xanthosoma_brasiliense")
node_for_Xanthosoma_brasiliense <- which(phylo_866_polyt_working$tip.label=="Xanthosoma_belophyllum")
edge_for_Xanthosoma_brasiliense <- which(phylo_866_polyt_working$edge[,2]==node_for_Xanthosoma_brasiliense)
edge_length_of_edge_for_Xanthosoma_brasiliense <- phylo_866_polyt_working$edge.length[edge_for_Xanthosoma_brasiliense]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Xanthosoma_brasiliense", edge.length=NULL, where=node_for_Xanthosoma_brasiliense,position=edge_length_of_edge_for_Xanthosoma_brasiliense/2, interactive=FALSE, )





node_for_checking <- getMRCA(phylo_866_polyt_working, c("Xanthosoma_caracu","Xanthosoma_sagittifolium"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)



#fifth, re-arrange so that X. caracu is sister to all other sps in the genus:



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Xanthosoma_brasiliense")
node_for_Xanthosoma_brasiliense <- getMRCA(phylo_866_polyt_working, c("Xanthosoma_poeppigii","Xanthosoma_undipes"))
edge_for_Xanthosoma_brasiliense <- which(phylo_866_polyt_working$edge[,2]==node_for_Xanthosoma_brasiliense)
edge_length_of_edge_for_Xanthosoma_brasiliense <- phylo_866_polyt_working$edge.length[edge_for_Xanthosoma_brasiliense]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Xanthosoma_brasiliense", edge.length=NULL, where=node_for_Xanthosoma_brasiliense,position=edge_length_of_edge_for_Xanthosoma_brasiliense/2,
   interactive=FALSE, )




phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Xanthosoma_belophyllum")
node_for_Xanthosoma_belophyllum <- which(phylo_866_polyt_working$tip.label=="Xanthosoma_brasiliense")
edge_for_Xanthosoma_belophyllum <- which(phylo_866_polyt_working$edge[,2]==node_for_Xanthosoma_belophyllum)
edge_length_of_edge_for_Xanthosoma_belophyllum <- phylo_866_polyt_working$edge.length[edge_for_Xanthosoma_belophyllum]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Xanthosoma_belophyllum", edge.length=NULL, where=node_for_Xanthosoma_belophyllum,position=edge_length_of_edge_for_Xanthosoma_belophyllum/2, interactive=FALSE, )

interactive=FALSE, )



node_for_checking <- getMRCA(phylo_866_polyt_working, c("Xanthosoma_caracu","Xanthosoma_sagittifolium"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)









## ok, move to clade 51: Annona
plot(clades_with_polyt[[51]],cex=0.9)
#Rolliniopsis sister to Rollinia, as they are closely related genera.
# Sources:
#  Maas, PJM. Nordic Journal of Botany 29: 257-356, 2011.
#  Walker, James W. “POLLEN MORPHOLOGY, PHYTOGEOGRAPHY, AND PHYLOGENY OF THE ANNONACEAE.” Contributions from the Gray Herbarium of Harvard University, no. 202, 1971, pp. 1–130
#Stelechocarpus is in subfam. Malmeoideae, which is sister to all other sps in this phylo (which are in subfam. Annonoideae). Source: https://species.wikimedia.org/wiki/



phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Rolliniopsis_discreta")
node_for_Rolliniopsis_discreta <- getMRCA(phylo_866_polyt_working, c("Rollinia_mucosa","Rollinia_dolabripetala","Rollinia_longifolia"))
edge_for_Rolliniopsis_discreta <- which(phylo_866_polyt_working$edge[,2]==node_for_Rolliniopsis_discreta)
edge_length_of_edge_for_Rolliniopsis_discreta <- phylo_866_polyt_working$edge.length[edge_for_Rolliniopsis_discreta]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Rolliniopsis_discreta", edge.length=NULL, where=node_for_Rolliniopsis_discreta,position=edge_length_of_edge_for_Rolliniopsis_discreta/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Stelechocarpus_burahol","Rolliniopsis_discreta"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)











## ok, move to clade 52: Rollinia
plot(clades_with_polyt[[52]],cex=0.9)

#longifolia is a former syn. of dolabripetala, which is an accepted name.
# sources:
#  Maas, PJM. Flora Neotropica, Vol. 57, Rollinia (Dec. 12, 1992), pp. 1-188
#  http://theplantlist.org/tpl1.1/
#thus i remove R. longifolia from phylo and database:


phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Rollinia_longifolia")


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Rollinia_mucosa","Rollinia_dolabripetala"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)


#good! i save the working tree, just in case:

write.tree(phylo_866_polyt_working,"data/phylo_866_polyt_working.tre")



str(phylo_866_polyt_working)
is.ultrametric(phylo_866_polyt_working)
is.binary(phylo_866_polyt_working)
#false, still 1 polyt. remaining..WHY??
is.rooted(phylo_866_polyt_working)
min(phylo_866_polyt_working$edge.length)
plot(phylo_866_polyt_working,cex=0.1)





### ...WHERE IS THAT POLYTOMY?:

node_polyt_working <- which(table(phylo_866_polyt_working$edge[,1])>2) #node ids (numbers) that are not bi-furcating
nodes_polyt_working_df <-as.data.frame(which(table(phylo_866_polyt_working$edge[,1])>2))
nodes_polyt_working_df$node.id <- as.numeric(rownames(nodes_polyt_working_df))
str(nodes_polyt_working_df)

##ok, now have to extract the clade with polytomy:
clade_with_polyt_working<-extract.clade(phylo_866_polyt_working,nodes_polyt_working_df[1,2],root.edge = 0, collapse.singles = TRUE,
              interactive = FALSE)


#plot it
plot(clade_with_polyt_working)

#ok, so there is a polytomy that remained undetected in the previous round
# i try to solve it:

## clade_with_polyt_working: Alpinia
plot(clade_with_polyt_working)
#globosa is in Sect. Alpinia subsect. Alpinia, which type is A. galanga. Source: Smith, R. (1990). Alpinia (Zingiberaceae): A Proposed New Infrageneric Classification. Edinburgh Journal of Botany, 47(1), 1-75.
# thus i re-bind it as sister to Alpinia galanga.
# officinarum (and thus its sister malaccensis) are in ect. Alpinia subsect. Cenolophon
# thus, they remain sister to the globosa-galanga clade

phylo_866_polyt_working <- drop.tip(phylo_866_polyt_working,"Alpinia_globosa")
node_for_Alpinia_globosa <- which(phylo_866_polyt_working$tip.label=="Alpinia_galanga")
edge_for_Alpinia_globosa <- which(phylo_866_polyt_working$edge[,2]==node_for_Alpinia_globosa)
edge_length_of_edge_for_Alpinia_globosa <- phylo_866_polyt_working$edge.length[edge_for_Alpinia_globosa]
phylo_866_polyt_working <- bind.tip(phylo_866_polyt_working, "Alpinia_globosa", edge.length=NULL, where=node_for_Alpinia_globosa,position=edge_length_of_edge_for_Alpinia_globosa/2,
   interactive=FALSE, )


node_for_checking <- getMRCA(phylo_866_polyt_working, c("Alpinia_galanga","Alpinia_officinarum"))

checking_clade <- extract.clade(phylo_866_polyt_working,node_for_checking)
plot(checking_clade)









str(phylo_866_polyt_working)
is.ultrametric(phylo_866_polyt_working)
is.binary(phylo_866_polyt_working)
#TRUE! NOW IT IS FULLY RESOLVED, NO POLYTOMIES!
is.rooted(phylo_866_polyt_working)
min(phylo_866_polyt_working$edge.length)
plot(phylo_866_polyt_working,cex=0.1)



#ok, i am done so i rename the tree:

phylo_866_crops_solved <- phylo_866_polyt_working
phylo_food_1_0 <- phylo_866_crops_solved
write.tree(phylo_866_crops_solved,"data/phylo_866_crops_solved.tre")
write.tree(phylo_866_crops_solved,"data/phylo_food_1_0.tre")








#which sps were in the GBOTB.extended phylo, and which ones had to be re-bound?
#script to get the set of sps in GBOTB.extended phylo:
Z<-name.check(GBOTB.extended.phylo, data)
phylo<-drop.tip(GBOTB.extended.phylo, Z$tree_not_data)
dt<- data[match(phylo$tip.label,rownames(data)),]
length(dt)
str(dt)

str(phylo)
is.ultrametric(phylo)
is.binary(phylo)
is.rooted(phylo)
min(phylo$edge.length)
plot(phylo,cex=0.1)
#ok, everything looks fine
sps_in_GBOTB <- phylo$tip.label
#661 sps already in GBOTB.extended
sps_not_in_GBOTB<-setdiff(rownames(data), rownames(dt))
#205 sps not in GBOTB











#################################################
#################################################
#################################################
#################################################
#################################################
#################################################








#################################################
#################################################

# 2.- SCRIPTS FOR BINDING ALL CROP SPS TO THE GBOTB PHYLOGENTY OF 74531 SPECIES OF VASCULAR PLANTS AVAILABLE IN V.PHYLOMAKER ("phylo_GBOTB_with_crops.tre")

#################################################
#################################################







setwd("C:/Users/ruben.milla/Desktop/macroevol_domest/data/database_categorical")#set your wd
#rm(list=ls()) # clean out elements

#load packages
library(ape)
library(devtools)
library(phytools)
library(geiger)


#read backbone tree:
# largest dated angiosp phylo tree (ca. 75000 sps) to date (9-apr-2019): GBOTB.extended phylo: 
#Jin Y & Qian H (2019) V.PhyloMaker: an R package that can generate very large phylogenies for vascular plants, Ecography, DOI: 10.1111/ecog.04434
#https://github.com/jinyizju/V.PhyloMaker
#not in CRAN, so stored as the zip file of the package at "V.PhyloMaker-master" folder 

load(file = "V.PhyloMaker-master/data/GBOTB.extended.rda")
GBOTB.extended.phylo <- GBOTB.extended
#plot(GBOTB.extended.phylo,type = "fan", cex=0.1)
#str(GBOTB.extended.phylo)

#get list of crop species:
data<-read.csv("data/database_categorical_partim.csv", header=T, dec=".", sep=";", row.names="Species_name_")
#str(data)
my_taxa <- data.frame(species = data$Species_name, genus = data$genus, family = data$Family)
str(my_taxa)

#source V.PhyloMaker functions:
source("V.PhyloMaker-master/R/phylo.maker.R")
source("V.PhyloMaker-master/R/ancestor.R")
source("V.PhyloMaker-master/R/bind.relative.R")
source("V.PhyloMaker-master/R/build.nodes.1.R")
source("V.PhyloMaker-master/R/build.nodes.2.R")
source("V.PhyloMaker-master/R/cluster.R")
source("V.PhyloMaker-master/R/ext.node.R")
source("V.PhyloMaker-master/R/int.node.R")
source("V.PhyloMaker-master/R/at.node.R")

#load V.PhyloMaker nodes and tips info data for GBOTB.extended phylo:
load(file = "V.PhyloMaker-master/data/nodes.info.1.rda")
load(file = "V.PhyloMaker-master/data/nodes.info.2.rda")
load(file = "V.PhyloMaker-master/data/tips.info.rda")


#which sps were in the GBOTB.extended phylo, and which ones had to be re-bound?
#script to get the set of sps in GBOTB.extended phylo:
Z<-name.check(GBOTB.extended.phylo, data)
phylo<-drop.tip(GBOTB.extended.phylo, Z$tree_not_data)
dt<- data[match(phylo$tip.label,rownames(data)),]
length(dt)
str(dt)

str(phylo)
is.ultrametric(phylo)
is.binary(phylo)
is.rooted(phylo)
min(phylo$edge.length)
plot(phylo,cex=0.1)
#ok, everything looks fine
sps_in_GBOTB <- phylo$tip.label
#661 sps already in GBOTB.extended
sps_not_in_GBOTB<-setdiff(rownames(data), rownames(dt))
#205 sps not in GBOTB


#i do a list of all taxa in GBOTB and all taxa of crop sps_not_in_GBOTB in the format required by phylo.maker:

#first list of taxa of crop sps_not_in_GBOTB:
data_for_binding <- data[is.element(row.names(data), sps_not_in_GBOTB),]
my_taxa_for_binding <- data.frame(species = data_for_bind_rel$Species_name, genus = data_for_bind_rel$genus, family = data_for_bind_rel$Family)
str(my_taxa_for_binding)

#i save that list externally in excel:
write.table (my_taxa_for_binding, "my_taxa_for_binding.txt")


#then a list of GBOTB taxa:
taxa_GBOTB <- tips.info[,c(2,3,4)]
taxa_GBOTB$species <- gsub('_', ' ', taxa_GBOTB$species)

#then bind both:
taxa_crops_plus_GBOTB <- rbind(taxa_GBOTB,my_taxa_for_binding)



### run phylo.maker to add the 205 crop sps not present in GBOTB, using Scen 1 (new tips are added as genus or family based polytomies) 
result <- phylo.maker(taxa_crops_plus_GBOTB, scenarios="S1")
phylo_74736_polyt <- result$scenario.1 #this is phylo_GBOTB_with_crops.tre
str(phylo_74736_polyt)
is.ultrametric(phylo_74736_polyt)
is.binary(phylo_74736_polyt)
#false, which is to be expected
is.rooted(phylo_74736_polyt)
min(phylo_74736_polyt$edge.length)
plot(phylo_74736_polyt,cex=0.1)
#write.tree(phylo_74736_polyt,"data/phylo_74736_polyt.txt")
#write.tree(phylo_74736_polyt,"data/milla_data_paper_supporting_information/phylo_food_v1_0phylo_GBOTB_with_crops.txt")















#################################################
#################################################
#################################################
#################################################
#################################################
#################################################

# END OF CODE

#################################################
#################################################
#################################################
#################################################
#################################################
#################################################
